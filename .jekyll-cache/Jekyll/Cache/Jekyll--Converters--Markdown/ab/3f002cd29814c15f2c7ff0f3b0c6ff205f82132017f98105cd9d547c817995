I"2•<h1 id="swiftui-firebase-ê¸°ëŠ¥-ì‚¬ìš©í•˜ê¸°">SwiftUI Firebase ê¸°ëŠ¥ ì‚¬ìš©í•˜ê¸°</h1>

<p>ì´ë²ˆ í¬ìŠ¤íŠ¸ì˜ ëª©ì ì€ SwiftUIì™€ Firebaseë¥¼ ì—°ë™ì‹œí‚¤ëŠ” ê¸°ëŠ¥ì„ êµ¬í˜„í•¨ìœ¼ë¡œì¨ ì„œë²„ë¥¼ ì§ì ‘ êµ¬ì¶•í•˜ëŠ” ìˆ˜ê³ ë¥¼ ëœê³ ìí•¨ì— ìˆë‹¤.</p>

<p>ì§ì ‘ êµ¬í˜„ì„ í•˜ë©´ì„œ ëŠë¼ëŠ” ê±°ì§€ë§Œ ì •ë§ ì‹ ì„¸ê³„ì´ë©° ë§¤ë²ˆ íŒŒì¼ ì—…ë¡œë“œ, db ì—°ë™ë“±ì„ ì§ì ‘ ì„œë²„ êµ¬ì¶•ì„ í•˜ë˜ ë‚˜ë¡œì„œëŠ” í¸í•˜ê²Œ ëŠê¼ˆë‹¤.</p>

<h1 id="1-firebase-file-upload">1. Firebase File Upload</h1>

<p>ì—¬ê¸°ì„œ êµ¬í˜„í•˜ê³ ì í•˜ëŠ” ê¸°ëŠ¥ì€</p>

<ul>
    <li>image picker êµ¬í˜„ìœ¼ë¡œ ì•¨ë²”ì—ì„œ ì‚¬ì§„ ë¶ˆëŸ¬ì˜¤ê¸°</li>
    <li>ì›í•˜ëŠ” ì‚¬ì§„ì„ ì˜ ë¶ˆëŸ¬ì™”ìœ¼ë©´, ê·¸ëŒ€ë¡œ Firebaseì— ì—…ë¡œë“œ</li>
    <li>ë‹¤ë¥¸ ì‚¬ì§„ì„ ì›í•œë‹¤ë©´ ë‹¤ì‹œ ì•¨ë²”ì—ì„œ ì‚¬ì§„ ë¶ˆëŸ¬ì˜¨ë’¤ Firebase storageì— ì—…ë¡œë“œ</li>
</ul>

<p>ì´ë ‡ê²Œ 3ê°€ì§€ë¡œ êµ¬ì„±ëœë‹¤. ë¨¼ì € ImagePickerë¶€í„° ì‚´í´ë³´ì.</p>

<p align="center">
    <img src="/img/swiftui_firebase/upload_screen.png" width="30%" style="margin-right: 60px;" />
    <img src="/img/swiftui_firebase/upload_screen2.png" width="30%" style="margin-left: 60px;" />
</p>

<div class="language-swift highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">import</span> <span class="kt">SwiftUI</span>

<span class="kd">struct</span> <span class="kt">UploadScreen</span><span class="p">:</span> <span class="kt">View</span> <span class="p">{</span>
    <span class="c1">// MARK: - PROPERTIES</span>
    <span class="kd">@State</span> <span class="kd">private</span> <span class="k">var</span> <span class="nv">isShowPhotoLibrary</span> <span class="o">=</span> <span class="kc">false</span>
    <span class="kd">@State</span> <span class="kd">private</span> <span class="k">var</span> <span class="nv">selectedImage</span><span class="p">:</span> <span class="kt">UIImage</span><span class="p">?</span>
    
    <span class="kd">@ObservedObject</span> <span class="k">var</span> <span class="nv">storageManager</span> <span class="o">=</span> <span class="kt">FirebaseStorageManager</span><span class="p">()</span>
    
    <span class="k">var</span> <span class="nv">body</span><span class="p">:</span> <span class="kd">some</span> <span class="kt">View</span> <span class="p">{</span>
        <span class="kt">VStack</span> <span class="p">{</span>
            
            <span class="k">if</span> <span class="n">selectedImage</span> <span class="o">!=</span> <span class="kc">nil</span> <span class="p">{</span>
                <span class="kt">Image</span><span class="p">(</span><span class="nv">uiImage</span><span class="p">:</span> <span class="n">selectedImage</span><span class="o">!</span><span class="p">)</span>
                    <span class="o">.</span><span class="nf">resizable</span><span class="p">()</span>
                    <span class="o">.</span><span class="nf">frame</span><span class="p">(</span><span class="nv">minWidth</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="nv">maxWidth</span><span class="p">:</span> <span class="o">.</span><span class="n">infinity</span><span class="p">)</span>
                    <span class="o">.</span><span class="nf">scaledToFit</span><span class="p">()</span>
                    <span class="o">.</span><span class="nf">padding</span><span class="p">()</span>
            <span class="p">}</span>
            
            
            <span class="kt">Button</span><span class="p">(</span><span class="nv">action</span><span class="p">:</span> <span class="p">{</span>
                <span class="k">self</span><span class="o">.</span><span class="n">isShowPhotoLibrary</span><span class="o">.</span><span class="nf">toggle</span><span class="p">()</span>
            <span class="p">})</span> <span class="p">{</span>
                <span class="kt">HStack</span> <span class="p">{</span>
                    <span class="kt">Image</span><span class="p">(</span><span class="nv">systemName</span><span class="p">:</span> <span class="s">"photo"</span><span class="p">)</span>
                        <span class="o">.</span><span class="nf">font</span><span class="p">(</span><span class="o">.</span><span class="nf">system</span><span class="p">(</span><span class="nv">size</span><span class="p">:</span> <span class="mi">20</span><span class="p">))</span>
                    
                    <span class="kt">Text</span><span class="p">(</span><span class="s">"Photo Library"</span><span class="p">)</span>
                        <span class="o">.</span><span class="nf">font</span><span class="p">(</span><span class="o">.</span><span class="n">headline</span><span class="p">)</span>
                <span class="p">}</span>
                <span class="o">.</span><span class="nf">frame</span><span class="p">(</span><span class="nv">minWidth</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="nv">maxWidth</span><span class="p">:</span> <span class="o">.</span><span class="n">infinity</span><span class="p">,</span> <span class="nv">minHeight</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="nv">maxHeight</span><span class="p">:</span> <span class="mi">50</span><span class="p">)</span>
                <span class="o">.</span><span class="nf">background</span><span class="p">(</span><span class="kt">Color</span><span class="o">.</span><span class="n">blue</span><span class="p">)</span>
                <span class="o">.</span><span class="nf">foregroundColor</span><span class="p">(</span><span class="o">.</span><span class="n">white</span><span class="p">)</span>
                <span class="o">.</span><span class="nf">cornerRadius</span><span class="p">(</span><span class="mi">20</span><span class="p">)</span>
                <span class="o">.</span><span class="nf">padding</span><span class="p">(</span><span class="o">.</span><span class="n">horizontal</span><span class="p">)</span>
            <span class="p">}</span>
            
            <span class="k">if</span> <span class="n">selectedImage</span> <span class="o">!=</span> <span class="kc">nil</span> <span class="p">{</span>
                <span class="kt">Button</span><span class="p">(</span><span class="nv">action</span><span class="p">:</span> <span class="p">{</span>
                    <span class="c1">// ê°€ì ¸ì˜¨ image data upload í•˜ê³  selectedImage ë¹ˆ ì´ë¯¸ì§€ë¡œ ë§Œë“¤ì–´ì£¼ëŠ” ê³³</span>
                    <span class="k">guard</span> <span class="k">let</span> <span class="nv">selectedImage</span> <span class="o">=</span> <span class="n">selectedImage</span> <span class="k">else</span> <span class="p">{</span>
                        <span class="k">return</span>
                    <span class="p">}</span>
                    <span class="n">storageManager</span><span class="o">.</span><span class="nf">uploadImage</span><span class="p">(</span><span class="nv">image</span><span class="p">:</span> <span class="n">selectedImage</span><span class="p">)</span>
                    <span class="n">withAnimation</span> <span class="p">{</span>
                        <span class="k">self</span><span class="o">.</span><span class="n">selectedImage</span> <span class="o">=</span> <span class="kc">nil</span>
                    <span class="p">}</span>
                <span class="p">})</span> <span class="p">{</span>
                    <span class="kt">HStack</span> <span class="p">{</span>
                        <span class="kt">Image</span><span class="p">(</span><span class="nv">systemName</span><span class="p">:</span> <span class="s">"icloud.and.arrow.up.fill"</span><span class="p">)</span>
                            <span class="o">.</span><span class="nf">font</span><span class="p">(</span><span class="o">.</span><span class="nf">system</span><span class="p">(</span><span class="nv">size</span><span class="p">:</span> <span class="mi">20</span><span class="p">))</span>
                        
                        <span class="kt">Text</span><span class="p">(</span><span class="s">"Upload Image"</span><span class="p">)</span>
                            <span class="o">.</span><span class="nf">font</span><span class="p">(</span><span class="o">.</span><span class="n">headline</span><span class="p">)</span>
                    <span class="p">}</span>
                    <span class="o">.</span><span class="nf">frame</span><span class="p">(</span><span class="nv">minWidth</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="nv">maxWidth</span><span class="p">:</span> <span class="o">.</span><span class="n">infinity</span><span class="p">,</span> <span class="nv">minHeight</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="nv">maxHeight</span><span class="p">:</span> <span class="mi">50</span><span class="p">)</span>
                    <span class="o">.</span><span class="nf">background</span><span class="p">(</span><span class="kt">Color</span><span class="o">.</span><span class="n">black</span><span class="p">)</span>
                    <span class="o">.</span><span class="nf">foregroundColor</span><span class="p">(</span><span class="o">.</span><span class="n">white</span><span class="p">)</span>
                    <span class="o">.</span><span class="nf">cornerRadius</span><span class="p">(</span><span class="mi">20</span><span class="p">)</span>
                    <span class="o">.</span><span class="nf">padding</span><span class="p">(</span><span class="o">.</span><span class="n">horizontal</span><span class="p">)</span>
                <span class="p">}</span>
            <span class="p">}</span>
        <span class="p">}</span> <span class="c1">//: VSTACK</span>
        <span class="o">.</span><span class="nf">sheet</span><span class="p">(</span><span class="nv">isPresented</span><span class="p">:</span> <span class="err">$</span><span class="n">isShowPhotoLibrary</span><span class="p">)</span> <span class="p">{</span>
            <span class="kt">Upload_ImagePicker</span><span class="p">(</span><span class="nv">image</span><span class="p">:</span> <span class="err">$</span><span class="n">selectedImage</span><span class="p">)</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>
<p>ìœ„ì˜ ì½”ë“œë¥¼ ë³´ë©´ isShowPhotoLibrary ë³€ìˆ˜ê°€ ê°¤ëŸ¬ë¦¬ë¥¼ ì—¬ëŠ” triggerê°€ ë˜ë©°, selectedImage ë³€ìˆ˜ëŠ” ê°¤ëŸ¬ë¦¬ì—ì„œ ì„ íƒí•œ ì‚¬ì§„ì„ ë‹´ì•„ì¤„ ë³€ìˆ˜ì´ë‹¤.</p>

<p>selectedImageì— ì•„ë¬´ëŸ° ì´ë¯¸ì§€ë„ ë‹´ê²¨ìˆì§€ ì•Šì„ ë•Œì—ëŠ” ì—…ë¡œë“œ ë²„íŠ¼ì´ë‚˜ ê³ ë¥¸ ì‚¬ì§„ì„ ë³´ì¼ í•„ìš”ê°€ ì—†ê¸°ë•Œë¬¸ì— ì½”ë“œ ìƒì—ì„œ if ë¬¸ìœ¼ë¡œ ì¡°ê±´ì„ ê±¸ì–´ë‘ì—ˆë‹¤. ë”°ë¼ì„œ ì„ íƒëœ ì‚¬ì§„ì´ ë³´ì¼ ê²½ìš°ì—ë§Œ ì‚¬ì§„ê³¼ upload buttonì´ ë³´ì¼ ê²ƒì´ë‹¤.</p>

<p>isShowPhotoLibraryí•¨ìˆ˜ë¡œ sheetí™”ë©´ì— ë”°ë¡œ êµ¬ì„±í•œ image_pickerí™”ë©´ì„ ë„ìš´ë‹¤. ê·¸ëŸ¼ Image_picker í™”ë©´ì„ ì‚´í´ë³´ì.</p>

<div class="language-swift highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">import</span> <span class="kt">SwiftUI</span>

<span class="kd">struct</span> <span class="kt">Upload_ImagePicker</span><span class="p">:</span> <span class="kt">UIViewControllerRepresentable</span> <span class="p">{</span>
    <span class="kd">@Binding</span> <span class="k">var</span> <span class="nv">image</span><span class="p">:</span> <span class="kt">UIImage</span><span class="p">?</span>
    <span class="kd">@Environment</span><span class="p">(\</span><span class="o">.</span><span class="n">presentationMode</span><span class="p">)</span> <span class="k">var</span> <span class="nv">mode</span>
    
    <span class="kd">func</span> <span class="nf">makeUIViewController</span><span class="p">(</span><span class="nv">context</span><span class="p">:</span> <span class="kt">Context</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kd">some</span> <span class="kt">UIViewController</span> <span class="p">{</span>
        <span class="k">let</span> <span class="nv">picker</span> <span class="o">=</span> <span class="kt">UIImagePickerController</span><span class="p">()</span>
        <span class="n">picker</span><span class="o">.</span><span class="n">delegate</span> <span class="o">=</span> <span class="n">context</span><span class="o">.</span><span class="n">coordinator</span>
        <span class="k">return</span> <span class="n">picker</span>
    <span class="p">}</span>
    
    <span class="kd">func</span> <span class="nf">makeCoordinator</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="kt">Coordinator</span> <span class="p">{</span>
        <span class="k">return</span> <span class="kt">Coordinator</span><span class="p">(</span><span class="k">self</span><span class="p">)</span>
    <span class="p">}</span>
    
    <span class="kd">func</span> <span class="nf">updateUIViewController</span><span class="p">(</span><span class="n">_</span> <span class="nv">uiViewController</span><span class="p">:</span> <span class="kt">UIViewControllerType</span><span class="p">,</span> <span class="nv">context</span><span class="p">:</span> <span class="kt">Context</span><span class="p">)</span> <span class="p">{</span>
        
    <span class="p">}</span>
    
    <span class="kd">class</span> <span class="kt">Coordinator</span><span class="p">:</span> <span class="kt">NSObject</span><span class="p">,</span> <span class="kt">UINavigationControllerDelegate</span><span class="p">,</span> <span class="kt">UIImagePickerControllerDelegate</span> <span class="p">{</span>
        <span class="k">let</span> <span class="nv">parent</span><span class="p">:</span> <span class="kt">Upload_ImagePicker</span>
        
        <span class="nf">init</span><span class="p">(</span><span class="n">_</span> <span class="nv">parent</span><span class="p">:</span> <span class="kt">Upload_ImagePicker</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">self</span><span class="o">.</span><span class="n">parent</span> <span class="o">=</span> <span class="n">parent</span>
        <span class="p">}</span>
        
        <span class="kd">func</span> <span class="nf">imagePickerController</span><span class="p">(</span><span class="n">_</span> <span class="nv">picker</span><span class="p">:</span> <span class="kt">UIImagePickerController</span><span class="p">,</span> <span class="n">didFinishPickingMediaWithInfo</span> <span class="nv">info</span><span class="p">:</span> <span class="p">[</span><span class="kt">UIImagePickerController</span><span class="o">.</span><span class="kt">InfoKey</span> <span class="p">:</span> <span class="kt">Any</span><span class="p">])</span> <span class="p">{</span>
            <span class="k">guard</span> <span class="k">let</span> <span class="nv">image</span> <span class="o">=</span> <span class="n">info</span><span class="p">[</span><span class="o">.</span><span class="n">originalImage</span><span class="p">]</span> <span class="k">as?</span> <span class="kt">UIImage</span> <span class="k">else</span> <span class="p">{</span> <span class="k">return</span> <span class="p">}</span>
            
            <span class="k">self</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">image</span> <span class="o">=</span> <span class="n">image</span>
            <span class="n">withAnimation</span> <span class="p">{</span>
                <span class="k">self</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">mode</span><span class="o">.</span><span class="n">wrappedValue</span><span class="o">.</span><span class="nf">dismiss</span><span class="p">()</span>                
            <span class="p">}</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<p>ì‚¬ì‹¤ ì´ ê¸€ì„ ì ëŠ” í•„ìë„ ì •í™•í•˜ê²Œ ì–¸ì–´ì ìœ¼ë¡œ ì–´ë–»ê²Œ ì´ê²Œ ë™ì‘í•˜ëŠ”ì§€ ëª¨ë¥´ê³  ê²€ìƒ‰ + ì™¸ì›Œì„œ ì‚¬ìš©í•˜ëŠ” ê¸°ëŠ¥ ì¤‘ í•˜ë‚˜ì´ë‹¤. ì½”ë”©ì€ ì „ë¶€ ì´í•´í•˜ê³  ì‚¬ìš©í•˜ë©´ ì¢‹ì§€ë§Œ, ì´í•´ê°€ ì•ˆê°€ë”ë˜ë„ ì­‰ í•œë²ˆ êµ¬í˜„í•˜ì! ê°€ ë‚˜ì˜ ëª¨í† ì´ê¸° ë•Œë¬¸ì— ìœ„ì˜ ë‚´ìš© ë° Googleì— â€˜swiftui image pickerâ€™ë¼ê³  ê²€ìƒ‰í•˜ë©´ ë‹¤ë¥¸ ì„¤ëª… ì˜ ë˜ì–´ìˆëŠ” ê³ ìˆ˜ ë¶„ë“¤ì´ ë§ê¸° ë•Œë¬¸ì— ì´ë¶€ë¶„ì—ì„œì˜ ì„¤ëª…ì€ ì¼ì¶•í•˜ê² ë‹¤.</p>

<p>ë‹¤ë§Œ ê¼­ ì•Œì•„ì•¼ë˜ëŠ” ê²ƒì€ @Binding var image ë³€ìˆ˜ê°€ ìˆëŠ”ë° ì´ ë¶€ë¶„ì˜ ê²½ìš°ì—ëŠ” ìš°ë¦¬ê°€ ì´ì „ í™”ë©´ì—ì„œ selectedImageë³€ìˆ˜ê°€ binding ë˜ì–´ì„œ ë„˜ì–´ì˜¨ë‹¤ëŠ” ì •ë„ëŠ” ì•Œê³  ìˆì–´ì•¼ í•œë‹¤. êµ¬í˜„í•˜ê²Œ ë˜ë©´ ì•„ë˜ì˜ ì‚¬ì§„ê³¼ ê°™ì´ í™”ë©´ì„ êµ¬ì„±í•  ìˆ˜ ìˆë‹¤.</p>

<p align="center">
    <img src="/img/swiftui_firebase/image_picker.png" width="30%" />
</p>

<p>ì›í•˜ëŠ” ì‚¬ì§„ì„ í„°ì¹˜í•˜ë©´ sheetë¡œ ì˜¬ë¼ì™”ë˜ Image_Picker í™”ë©´ì´ ì‚¬ë¼ì§€ê³  selectedImageì— imageì •ë³´ê°€ ë“¤ì–´ê°€ë©° í™”ë©´ êµ¬ì„±ì´ ë°”ë€ë‹¤.</p>

<h3 id="firebase-file-upload">Firebase File Upload</h3>
<p>ì ì´ì œ ë³¸ê²©ì ìœ¼ë¡œ ì„ íƒí•œ ì‚¬ì§„ì„ Firebaseì— ì—…ë¡œë“œ í•´ë³´ì. ë¨¼ì € Firebaseì— ìì‹ ì˜ í”„ë¡œì íŠ¸ë¥¼ ì„¤ì •í•´ì£¼ê³  iOSì—°ë™ê¹Œì§€ ë§ˆì¹˜ì.(ì•ì„  í¬íŠ¸íŠ¸ google loginì„ êµ¬í˜„í•˜ëŠ” í¬ìŠ¤íŠ¸ì— í”„ë¡œì íŠ¸ ìƒì„±ê´€ë ¨ ë‚´ìš©ì´ ìˆìœ¼ë‹ˆ ì°¸ê³ .)</p>

<p>í”„ë¡œì íŠ¸ë¥¼ ì„¤ì •í–ˆë‹¤ë©´,</p>

<p><img src="/img/swiftui_firebase/firebase_console.png" alt="firebase_console" /></p>

<p>ìœ„ ê·¸ë¦¼ì— í‘œì‹œí•œ ë¶€ë¶„ì„ ëˆŒëŸ¬ ì´ˆê¸° ì„¤ì •ì„ í•´ì¤€ë‹¤.</p>

<p>pod â€˜Firebase/Storageâ€™ ë¥¼ Podfileì— ì¶”ê°€í•´ì¤€ ë’¤, pod install.</p>

<p>ì´í›„ firebaseê¸°ëŠ¥ë“¤ì„ ìˆ˜í–‰í•  swift íŒŒì¼ì„ í•˜ë‚˜ ë§Œë“¤ì–´ ì¤€ë‹¤. í•„ìëŠ” FirebaseStorageManger.swiftë¥¼ ìƒì„±í•´ ê¸°ì¡´ì— modelì²˜ëŸ¼ ì‚¬ìš©í•˜ëŠ” ê²ƒìœ¼ë¡œ êµ¬ì„±í–ˆë‹¤.</p>

<div class="language-swift highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">import</span> <span class="kt">SwiftUI</span>
<span class="kd">import</span> <span class="kt">FirebaseStorage</span>

<span class="kd">class</span> <span class="kt">FirebaseStorageManager</span><span class="p">:</span><span class="kt">ObservableObject</span> <span class="p">{</span>
    <span class="c1">// MARK: - PROPERTIES</span>
    <span class="kd">private</span> <span class="k">let</span> <span class="nv">storage</span> <span class="o">=</span> <span class="kt">Storage</span><span class="o">.</span><span class="nf">storage</span><span class="p">()</span>
    
    <span class="c1">// upload function</span>
    <span class="kd">func</span> <span class="nf">uploadImage</span><span class="p">(</span><span class="nv">image</span><span class="p">:</span> <span class="kt">UIImage</span><span class="p">)</span> <span class="p">{</span>
        <span class="c1">// change the type of file. If you don't, file saved in storage will be of type application/octet-stream</span>
        <span class="k">let</span> <span class="nv">metadata</span> <span class="o">=</span> <span class="kt">StorageMetadata</span><span class="p">()</span>
        <span class="n">metadata</span><span class="o">.</span><span class="n">contentType</span> <span class="o">=</span> <span class="s">"image/jpg"</span>
        
        <span class="c1">// í˜„ì¬ì‹œê°„ì„ ì´ë¯¸ì§€ ì´ë¦„ìœ¼ë¡œ ì •í•œë‹¤</span>
        <span class="k">let</span> <span class="nv">imageName</span> <span class="o">=</span> <span class="kt">UUID</span><span class="p">()</span><span class="o">.</span><span class="n">uuidString</span> <span class="o">+</span> <span class="kt">String</span><span class="p">(</span><span class="kt">Date</span><span class="p">()</span><span class="o">.</span><span class="n">timeIntervalSince1970</span><span class="p">)</span>
        
        <span class="c1">// Create a storage reference</span>
        <span class="k">let</span> <span class="nv">storageRef</span> <span class="o">=</span> <span class="n">storage</span><span class="o">.</span><span class="nf">reference</span><span class="p">()</span><span class="o">.</span><span class="nf">child</span><span class="p">(</span><span class="s">"images/</span><span class="se">\(</span><span class="n">imageName</span><span class="se">)</span><span class="s">.jpg"</span><span class="p">)</span>
        
        <span class="c1">// ì—¬ê¸°ì„œ resizeí•´ì¤˜ì•¼ í•œë‹¤</span>
        
        <span class="c1">// Convert the image into JPEG and compress the quality to reduce its size</span>
        <span class="k">let</span> <span class="nv">data</span> <span class="o">=</span> <span class="n">image</span><span class="o">.</span><span class="nf">jpegData</span><span class="p">(</span><span class="nv">compressionQuality</span><span class="p">:</span> <span class="mf">0.2</span><span class="p">)</span>
        
        <span class="k">if</span> <span class="k">let</span> <span class="nv">data</span> <span class="o">=</span> <span class="n">data</span> <span class="p">{</span>
            <span class="n">storageRef</span><span class="o">.</span><span class="nf">putData</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="nv">metadata</span><span class="p">:</span> <span class="n">metadata</span><span class="p">){</span> <span class="p">(</span><span class="n">metadata</span><span class="p">,</span> <span class="n">error</span><span class="p">)</span> <span class="k">in</span>
                <span class="k">if</span> <span class="k">let</span> <span class="nv">error</span> <span class="o">=</span> <span class="n">error</span> <span class="p">{</span>
                    <span class="nf">print</span><span class="p">(</span><span class="s">"Error while uploading file: "</span><span class="p">,</span> <span class="n">error</span><span class="p">)</span>
                <span class="p">}</span>
                
                <span class="k">if</span> <span class="k">let</span> <span class="nv">metadata</span> <span class="o">=</span> <span class="n">metadata</span> <span class="p">{</span>
                    <span class="nf">print</span><span class="p">(</span><span class="s">"Metadata: "</span><span class="p">,</span> <span class="n">metadata</span><span class="p">)</span>
                <span class="p">}</span>
            <span class="p">}</span>
        <span class="p">}</span>
    <span class="p">}</span> <span class="c1">// end upload function</span>
<span class="p">}</span>
</code></pre></div></div>
<p>pod installì„ í•˜ê²Œ ë˜ë©´ FirebaseStorageë¥¼ import í•  ìˆ˜ ìˆë‹¤. Firebase storageë¥¼ ì‚¬ìš©í•˜ë©´ì„œ ëŠë‚€ì ì€ ì •ë§ ê°„ë‹¨í•˜ë‹¤ëŠ” ê²ƒì´ë‹¤. ìœ„ì˜ storageRefë¡œ ë‚´ê°€ Firebase ë‚´ì—ì„œ ì €ì¥í•  ê²½ë¡œë¥¼ ì§€ì •í•´ ì¤„ ìˆ˜ ìˆë‹¤. ë³´í†µ AWS S3 ì„œë¹„ìŠ¤ì— ì—…ë¡œë“œí•˜ëŠ” ì‘ì—…ì„ ì§„í–‰í–ˆì—ˆëŠ”ë° ê·¸ì— ë¹„í•´ ì •ë§ í¸í•˜ë‹¤ :)</p>

<h1 id="2-firebase-database">2. Firebase database</h1>

<p>ê¸°ì¡´ì˜ ì„œë²„ì—ì„œ í•˜ë˜ëŒ€ë¡œ ì´ë¯¸ì§€ë¥¼ ì €ì¥í•˜ê³  ê·¸ ê²½ë¡œë¥¼ dbì— ì €ì¥í•˜ì—¬ ì´ë¯¸ì§€ë¥¼ urlë¡œ ë¶ˆëŸ¬ì˜¤ëŠ” ì‘ì—…ì„ í•˜ê¸° ìœ„í•´ databaseì— ë°ì´í„°ë¥¼ ì €ì¥í•˜ëŠ” ì‘ì—…ì„ í•  ê²ƒì´ë‹¤.</p>

<p>ë¨¼ì € Podfileì„ ì—´ê³  pod â€˜Firebase/Firestoreâ€™ ì‘ì„± í›„ pod install!</p>

<p><img src="/img/swiftui_firebase/firebase_console2.png" alt="firebase_console2" /></p>

<p>ë¥¼ ëˆŒëŸ¬ ì´ˆê¸° ì„¤ì •ì„ í•´ì¤˜ì•¼ í•œë‹¤. ë‚˜ëŠ” ê³„ì† mysqlë§Œ ì¨ì™€ì„œ ì²˜ìŒ ì¨ë³´ëŠ” í˜•ì‹ì´ê¸´ í•œë°, í•œë²ˆì€ ì‚¬ìš©í•´ë³´ê³  ì‹¶ì—ˆë‹¤.</p>

<div class="language-swift highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">import</span> <span class="kt">FirebaseFirestore</span>

<span class="kd">private</span> <span class="k">var</span> <span class="nv">db</span> <span class="o">=</span> <span class="kt">Firestore</span><span class="o">.</span><span class="nf">firestore</span><span class="p">()</span>

<span class="c1">// add image data</span>
    <span class="kd">func</span> <span class="nf">addImageData</span><span class="p">(</span><span class="nv">data</span><span class="p">:</span> <span class="kt">ImageData</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">do</span> <span class="p">{</span>
           <span class="k">let</span> <span class="nv">_</span> <span class="o">=</span> <span class="k">try</span> <span class="n">db</span><span class="o">.</span><span class="nf">collection</span><span class="p">(</span><span class="s">"images"</span><span class="p">)</span><span class="o">.</span><span class="nf">addDocument</span><span class="p">(</span><span class="nv">data</span><span class="p">:</span> <span class="n">data</span><span class="o">.</span><span class="nf">getDict</span><span class="p">())</span>
        <span class="p">}</span>
        <span class="k">catch</span> <span class="p">{</span>
            <span class="nf">print</span><span class="p">(</span><span class="n">error</span><span class="o">.</span><span class="n">localizedDescription</span><span class="p">)</span>
        <span class="p">}</span>
    <span class="p">}</span> <span class="c1">// end addImageData function</span>
</code></pre></div></div>
<p>ì´ê²Œ ëì´ë‹¤. ì •ë§ ê°„ë‹¨í•˜ë‹¤. ìœ„ì˜ Manager classì— í•¨ìˆ˜ë¡œ ì„ ì–¸í•œë‹¤. ì „ì²´ ì½”ë“œëŠ” ì•„ë˜ì— ì‘ì„±í† ë¡ í•˜ê² ë‹¤.</p>

<p>ì¶”ê°€ì ìœ¼ë¡œ ë‚´ê°€ í•´ë©¨ë˜ ë¶€ë¶„ì„ ì‘ì„±í•˜ê³ ì í•œë‹¤. ë³´í†µ ì´ë¯¸ì§€ë¥¼ ì—…ë¡œë“œí•˜ê³  base url + image nameì„ í†µí•´ urlì„ ë§Œë“¤ì–´ ì´ë¯¸ì§€ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ”ë° ì²˜ìŒ Firebase file uploadë¥¼ í•˜ê³  ë‚˜ì„œëŠ” ê·¸ ê²½ë¡œë¥¼ ì–´ë–»ê²Œ ì¡ì•„ì•¼í•˜ëŠ”ì§€ ëª°ëë‹¤.</p>

<p>ë§ì€ ê²€ìƒ‰ì„ í•´ë³¸ ë’¤ download urlì„ file uploadì‹œ ë°›ì„ ìˆ˜ ìˆëŠ” ë°©ë²•ì´ ìˆì—ˆë‹¤. ë”°ë¼ì„œ file upload í•˜ëŠ” ë¶€ë¶„ì—ì„œ download urlì„ ì–»ì€ ë‹¤ìŒ ê·¸ ì •ë³´ë¥¼ dbì— ë„£ì–´ì¤˜ì•¼ í•˜ëŠ” ë°©ë²•ì´ë‹¤.</p>

<p>ì „ì²´ FirebaseStorageManager.swiftë¥¼ ë³´ë©´,</p>

<div class="language-swift highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">import</span> <span class="kt">SwiftUI</span>
<span class="kd">import</span> <span class="kt">GoogleSignIn</span>
<span class="kd">import</span> <span class="kt">FirebaseStorage</span>
<span class="kd">import</span> <span class="kt">FirebaseFirestore</span>

<span class="kd">class</span> <span class="kt">FirebaseStorageManager</span><span class="p">:</span><span class="kt">ObservableObject</span> <span class="p">{</span>
    <span class="c1">// MARK: - PROPERTIES</span>
    <span class="kd">private</span> <span class="k">let</span> <span class="nv">user</span> <span class="o">=</span> <span class="kt">GIDSignIn</span><span class="o">.</span><span class="n">sharedInstance</span><span class="o">.</span><span class="n">currentUser</span>
    <span class="kd">private</span> <span class="k">let</span> <span class="nv">storage</span> <span class="o">=</span> <span class="kt">Storage</span><span class="o">.</span><span class="nf">storage</span><span class="p">()</span>
    <span class="kd">private</span> <span class="k">var</span> <span class="nv">db</span> <span class="o">=</span> <span class="kt">Firestore</span><span class="o">.</span><span class="nf">firestore</span><span class="p">()</span>
    
    <span class="c1">// add image data</span>
    <span class="kd">func</span> <span class="nf">addImageData</span><span class="p">(</span><span class="nv">data</span><span class="p">:</span> <span class="kt">ImageData</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">do</span> <span class="p">{</span>
           <span class="k">let</span> <span class="nv">_</span> <span class="o">=</span> <span class="k">try</span> <span class="n">db</span><span class="o">.</span><span class="nf">collection</span><span class="p">(</span><span class="s">"images"</span><span class="p">)</span><span class="o">.</span><span class="nf">addDocument</span><span class="p">(</span><span class="nv">data</span><span class="p">:</span> <span class="n">data</span><span class="o">.</span><span class="nf">getDict</span><span class="p">())</span>
        <span class="p">}</span>
        <span class="k">catch</span> <span class="p">{</span>
            <span class="nf">print</span><span class="p">(</span><span class="n">error</span><span class="o">.</span><span class="n">localizedDescription</span><span class="p">)</span>
        <span class="p">}</span>
    <span class="p">}</span> <span class="c1">// end addImageData function</span>
    
    
    <span class="c1">// upload function</span>
    <span class="kd">func</span> <span class="nf">uploadImage</span><span class="p">(</span><span class="nv">image</span><span class="p">:</span> <span class="kt">UIImage</span><span class="p">)</span> <span class="p">{</span>
        <span class="c1">// change the type of file. If you don't, file saved in storage will be of type application/octet-stream</span>
        <span class="k">let</span> <span class="nv">metadata</span> <span class="o">=</span> <span class="kt">StorageMetadata</span><span class="p">()</span>
        <span class="n">metadata</span><span class="o">.</span><span class="n">contentType</span> <span class="o">=</span> <span class="s">"image/jpg"</span>
        
        <span class="c1">// í˜„ì¬ì‹œê°„ì„ ì´ë¯¸ì§€ ì´ë¦„ìœ¼ë¡œ ì •í•œë‹¤</span>
        <span class="k">let</span> <span class="nv">imageName</span> <span class="o">=</span> <span class="kt">UUID</span><span class="p">()</span><span class="o">.</span><span class="n">uuidString</span> <span class="o">+</span> <span class="kt">String</span><span class="p">(</span><span class="kt">Date</span><span class="p">()</span><span class="o">.</span><span class="n">timeIntervalSince1970</span><span class="p">)</span>
        
        <span class="c1">// Create a storage reference</span>
        <span class="k">let</span> <span class="nv">storageRef</span> <span class="o">=</span> <span class="n">storage</span><span class="o">.</span><span class="nf">reference</span><span class="p">()</span><span class="o">.</span><span class="nf">child</span><span class="p">(</span><span class="s">"images/</span><span class="se">\(</span><span class="n">imageName</span><span class="se">)</span><span class="s">.jpg"</span><span class="p">)</span>
        
        <span class="c1">// ì—¬ê¸°ì„œ resizeí•´ì¤˜ì•¼ í•œë‹¤</span>
        
        <span class="c1">// Convert the image into JPEG and compress the quality to reduce its size</span>
        <span class="k">let</span> <span class="nv">data</span> <span class="o">=</span> <span class="n">image</span><span class="o">.</span><span class="nf">jpegData</span><span class="p">(</span><span class="nv">compressionQuality</span><span class="p">:</span> <span class="mf">0.2</span><span class="p">)</span>
        
        <span class="k">if</span> <span class="k">let</span> <span class="nv">data</span> <span class="o">=</span> <span class="n">data</span> <span class="p">{</span>
            <span class="n">storageRef</span><span class="o">.</span><span class="nf">putData</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="nv">metadata</span><span class="p">:</span> <span class="n">metadata</span><span class="p">){</span> <span class="p">(</span><span class="n">metadata</span><span class="p">,</span> <span class="n">error</span><span class="p">)</span> <span class="k">in</span>
                <span class="k">if</span> <span class="k">let</span> <span class="nv">error</span> <span class="o">=</span> <span class="n">error</span> <span class="p">{</span>
                    <span class="nf">print</span><span class="p">(</span><span class="s">"Error while uploading file: "</span><span class="p">,</span> <span class="n">error</span><span class="p">)</span>
                <span class="p">}</span>
                
                <span class="k">if</span> <span class="k">let</span> <span class="nv">metadata</span> <span class="o">=</span> <span class="n">metadata</span> <span class="p">{</span>
                    <span class="nf">print</span><span class="p">(</span><span class="s">"Metadata: "</span><span class="p">,</span> <span class="n">metadata</span><span class="p">)</span>
                <span class="p">}</span>
                
                <span class="n">storageRef</span><span class="o">.</span><span class="n">downloadURL</span><span class="p">{</span> <span class="n">url</span><span class="p">,</span> <span class="n">_</span> <span class="k">in</span>
                    <span class="k">guard</span> <span class="k">let</span> <span class="nv">url</span> <span class="o">=</span> <span class="n">url</span> <span class="k">else</span> <span class="p">{</span> <span class="k">return</span> <span class="p">}</span>
                    <span class="c1">// databaseì—ë„ uploadí•œ ì´ë¯¸ì§€ì˜ ë°ì´í„°ë¥¼ ì €ì¥í•´ì£¼ì</span>
                    <span class="k">let</span> <span class="nv">imageData</span> <span class="o">=</span> <span class="kt">ImageData</span><span class="p">(</span><span class="nv">image_name</span><span class="p">:</span> <span class="n">url</span><span class="o">.</span><span class="n">absoluteString</span><span class="p">,</span> <span class="nv">image_label</span><span class="p">:</span> <span class="kc">nil</span><span class="p">,</span> <span class="nv">image_category</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="nv">upload_user</span><span class="p">:</span> <span class="k">self</span><span class="o">.</span><span class="n">user</span><span class="p">?</span><span class="o">.</span><span class="n">profile</span><span class="p">?</span><span class="o">.</span><span class="n">email</span> <span class="p">??</span> <span class="s">""</span><span class="p">,</span> <span class="nv">create_date</span><span class="p">:</span> <span class="kt">Date</span><span class="o">.</span><span class="n">now</span><span class="p">,</span> <span class="nv">label_date</span><span class="p">:</span> <span class="kc">nil</span><span class="p">)</span>
                    
                    <span class="k">self</span><span class="o">.</span><span class="nf">addImageData</span><span class="p">(</span><span class="nv">data</span><span class="p">:</span> <span class="n">imageData</span><span class="p">)</span>
                <span class="p">}</span>
            <span class="p">}</span>
        <span class="p">}</span>
    <span class="p">}</span> <span class="c1">// end upload function</span>
<span class="p">}</span>
</code></pre></div></div>
<p>ìœ„ì™€ ê°™ì´ êµ¬ì„±ë˜ë©° ì‹¤ì œë¡œ ì‚¬ìš©í•  ë•Œì—ëŠ”, ìœ„ì—ì„œ ìš°ë¦¬ê°€ ë§Œë“  upload screenì—ì„œ ì´ë¯¸ì§€ë¥¼ ë¶ˆëŸ¬ì˜¨ë’¤ upload buttonì˜ action ë¶€ë¶„ì— ë„£ì–´ì£¼ë©´ ëœë‹¤.</p>

<div class="language-swift highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kt">Button</span><span class="p">(</span><span class="nv">action</span><span class="p">:</span> <span class="p">{</span>
    <span class="c1">// ê°€ì ¸ì˜¨ image data upload í•˜ê³  selectedImage ë¹ˆ ì´ë¯¸ì§€ë¡œ ë§Œë“¤ì–´ì£¼ëŠ” ê³³</span>
    <span class="k">guard</span> <span class="k">let</span> <span class="nv">selectedImage</span> <span class="o">=</span> <span class="n">selectedImage</span> <span class="k">else</span> <span class="p">{</span>
        <span class="k">return</span>
    <span class="p">}</span>
    <span class="n">storageManager</span><span class="o">.</span><span class="nf">uploadImage</span><span class="p">(</span><span class="nv">image</span><span class="p">:</span> <span class="n">selectedImage</span><span class="p">)</span>
        <span class="n">withAnimation</span> <span class="p">{</span>
            <span class="k">self</span><span class="o">.</span><span class="n">selectedImage</span> <span class="o">=</span> <span class="kc">nil</span>
        <span class="p">}</span>
    <span class="p">})</span> <span class="p">{</span>
        <span class="kt">HStack</span> <span class="p">{</span>
            <span class="kt">Image</span><span class="p">(</span><span class="nv">systemName</span><span class="p">:</span> <span class="s">"icloud.and.arrow.up.fill"</span><span class="p">)</span>
                <span class="o">.</span><span class="nf">font</span><span class="p">(</span><span class="o">.</span><span class="nf">system</span><span class="p">(</span><span class="nv">size</span><span class="p">:</span> <span class="mi">20</span><span class="p">))</span>
            
            <span class="kt">Text</span><span class="p">(</span><span class="s">"Upload Image"</span><span class="p">)</span>
                <span class="o">.</span><span class="nf">font</span><span class="p">(</span><span class="o">.</span><span class="n">headline</span><span class="p">)</span>
        <span class="p">}</span>
        <span class="o">.</span><span class="nf">frame</span><span class="p">(</span><span class="nv">minWidth</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="nv">maxWidth</span><span class="p">:</span> <span class="o">.</span><span class="n">infinity</span><span class="p">,</span> <span class="nv">minHeight</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="nv">maxHeight</span><span class="p">:</span> <span class="mi">50</span><span class="p">)</span>
        <span class="o">.</span><span class="nf">background</span><span class="p">(</span><span class="kt">Color</span><span class="o">.</span><span class="n">black</span><span class="p">)</span>
        <span class="o">.</span><span class="nf">foregroundColor</span><span class="p">(</span><span class="o">.</span><span class="n">white</span><span class="p">)</span>
        <span class="o">.</span><span class="nf">cornerRadius</span><span class="p">(</span><span class="mi">20</span><span class="p">)</span>
        <span class="o">.</span><span class="nf">padding</span><span class="p">(</span><span class="o">.</span><span class="n">horizontal</span><span class="p">)</span>
<span class="p">}</span>
</code></pre></div></div>
:ET