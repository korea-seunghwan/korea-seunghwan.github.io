I"§€<h2 id="request-parameterë¥¼-ë‹¤ë¤„ë³´ì">Request parameterë¥¼ ë‹¤ë¤„ë³´ì</h2>
<p>apië¥¼ êµ¬ì„±í•˜ëŠ” ë™ì•ˆì— ìš°ë¦¬ëŠ” base_url/search/1 í˜•íƒœì˜ idê°’ìœ¼ë¡œ íŠ¹ì • ì •ë³´ë¥¼ ì°¾ëŠ” ê²½ìš°ê°€ ìˆë‹¤. ì´ëŸ¬í•œ ê²½ìš° ì–´ë–»ê²Œ urlì„ êµ¬ì„±í•˜ëŠ”ì§€, ì–´ë–»ê²Œ ë“¤ì–´ì˜¨ ê°’ì„ ì‚¬ìš©í•˜ëŠ”ì§€ ì•Œì•„ë³´ë„ë¡ í•˜ì.</p>

<p>ë¨¼ì € controllerì— ë‚´ê°€ urlì„ ì–´ë–¤ì‹ìœ¼ë¡œ ë°›ì„ ê²ƒì¸ì§€, ì–´ë–¤ í•¨ìˆ˜ë¡œ ê¸°ëŠ¥ì„ êµ¬í˜„í•  ê²ƒì¸ì§€ ì„¤ì •í•´ì£¼ì</p>

<div class="language-typescript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">@</span><span class="nd">Get</span><span class="p">(</span><span class="dl">'</span><span class="s1">:id</span><span class="dl">'</span><span class="p">)</span>
  <span class="nx">getCustomer</span><span class="p">(</span>
    <span class="p">@</span><span class="nd">Param</span><span class="p">(</span><span class="dl">'</span><span class="s1">id</span><span class="dl">'</span><span class="p">,</span> <span class="nx">ParseIntPipe</span><span class="p">)</span> <span class="nx">id</span><span class="p">:</span> <span class="kr">number</span><span class="p">,</span>
    <span class="p">@</span><span class="nd">Req</span><span class="p">()</span> <span class="nx">req</span><span class="p">:</span> <span class="nx">Request</span><span class="p">,</span>
    <span class="p">@</span><span class="nd">Res</span><span class="p">()</span> <span class="nx">res</span><span class="p">:</span> <span class="nx">Response</span><span class="p">,</span>
  <span class="p">)</span> <span class="p">{</span>
    <span class="c1">// console.log(typeof id);</span>
    <span class="kd">const</span> <span class="nx">customer</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">customersService</span><span class="p">.</span><span class="nx">findCustomerById</span><span class="p">(</span><span class="nx">id</span><span class="p">);</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">customer</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">res</span><span class="p">.</span><span class="nx">send</span><span class="p">(</span><span class="nx">customer</span><span class="p">);</span>
    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
      <span class="nx">res</span><span class="p">.</span><span class="nx">status</span><span class="p">(</span><span class="mi">400</span><span class="p">).</span><span class="nx">send</span><span class="p">({</span> <span class="na">msg</span><span class="p">:</span> <span class="dl">'</span><span class="s1">Customer not found</span><span class="dl">'</span> <span class="p">});</span>
    <span class="p">}</span>
  <span class="p">}</span>
</code></pre></div></div>

<p>ìœ„ì˜ ì½”ë“œë¥¼ ë¶„ì„í•´ë³´ë©´ ë¨¼ì € @Get()ì„ í†µí•´ì„œ ì–´ë–¤ urlë¡œ ë°›ì„ ê²ƒì¸ì§€ ì„¤ì •í•´ì¤€ë‹¤.</p>

<p>@Get() ê´„í˜¸ ì•ˆì˜ ê°’ì€ ë‚´ê°€ ë°›ì„ ì¸ìë¥¼ ì„ íƒí•´ì£¼ëŠ” ê²ƒì¸ë° â€˜:idâ€™ë¡œ ë°›ê³  ìˆê¸° ë•Œë¬¸ì— ë‚´ê°€ idê°’ì„ ë°›ê³ ìˆë‹¤ëŠ” ê²ƒì„ ë‚˜íƒ€ë‚¸ë‹¤.</p>

<p>ì‹¤ì œë¡œ êµ¬í˜„ë˜ëŠ” í•¨ìˆ˜ ì•ˆì„ ë³´ë©´ @Param(â€˜idâ€™, ParseIntPipe) id: number ë¥¼ ë³¼ ìˆ˜ ìˆë‹¤.</p>

<p>id ê°’ìœ¼ë¡œ ë„˜ì–´ì˜¤ëŠ” parameterë¥¼ ë°›ê² ë‹¤ëŠ” í‘œì‹œì´ë©° ParseIntPipeëŠ” parameterë¡œ ë„˜ì–´ì˜¤ëŠ” ê°’ì´ string í˜•íƒœë¡œ ë„˜ì–´ì˜¤ê¸° ë•Œë¬¸ì— ì´ë¥¼ int í˜•íƒœë¡œ ìë™ìœ¼ë¡œ ë°”ê¾¸ê³ ì ë„£ì–´ì£¼ëŠ” parserì´ë‹¤.</p>

<p>ìš°ë¦¬ëŠ” int í˜•íƒœì˜ idê°’ì„ ë§¤ê°œì²´ë¡œ userë¥¼ ì°¾ì•„ì¤„ ê²ƒì´ê¸° ë•Œë¬¸ì— idë¥¼ number í˜•íƒœë¡œ ë°›ëŠ”ë‹¤.</p>

<p>ì´ë¥¼ êµ¬í˜„í•œ service íŒŒì¼ì„ ë³´ë©´,</p>

<div class="language-typescript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">@</span><span class="nd">Injectable</span><span class="p">()</span>
<span class="k">export</span> <span class="kd">class</span> <span class="nx">CustomersService</span> <span class="p">{</span>
  <span class="nx">users</span> <span class="o">=</span> <span class="p">[</span>
    <span class="p">{</span>
      <span class="na">id</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
      <span class="na">email</span><span class="p">:</span> <span class="dl">'</span><span class="s1">senghan1992@gmail.com</span><span class="dl">'</span><span class="p">,</span>
      <span class="na">createdAt</span><span class="p">:</span> <span class="k">new</span> <span class="nb">Date</span><span class="p">(),</span>
    <span class="p">},</span>
    <span class="p">{</span>
      <span class="na">id</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span>
      <span class="na">email</span><span class="p">:</span> <span class="dl">'</span><span class="s1">adam@gmail.com</span><span class="dl">'</span><span class="p">,</span>
      <span class="na">createdAt</span><span class="p">:</span> <span class="k">new</span> <span class="nb">Date</span><span class="p">(),</span>
    <span class="p">},</span>
    <span class="p">{</span>
      <span class="na">id</span><span class="p">:</span> <span class="mi">3</span><span class="p">,</span>
      <span class="na">email</span><span class="p">:</span> <span class="dl">'</span><span class="s1">danny@gmail.com</span><span class="dl">'</span><span class="p">,</span>
      <span class="na">createdAt</span><span class="p">:</span> <span class="k">new</span> <span class="nb">Date</span><span class="p">(),</span>
    <span class="p">},</span>
  <span class="p">];</span>

  <span class="nx">findCustomerById</span><span class="p">(</span><span class="nx">id</span><span class="p">:</span> <span class="kr">number</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">users</span><span class="p">.</span><span class="nx">find</span><span class="p">((</span><span class="nx">user</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="nx">user</span><span class="p">.</span><span class="nx">id</span> <span class="o">==</span> <span class="nx">id</span><span class="p">);</span>
  <span class="p">}</span>
<span class="p">}</span>

</code></pre></div></div>
<p>ì¼ë‹¨ ì„ì‹œ ë°ì´í„° ë¦¬ìŠ¤íŠ¸ë¥¼ ë§Œë“¤ì–´ì£¼ê³  ë°ì´í„°ë¥¼ ì„ì˜ë¡œ ìƒì„±í•´ì¤€ë‹¤.</p>

<p>ì‹¤ì œ êµ¬í˜„ëœ findCustomerById(id: number) í•¨ìˆ˜ë¥¼ ë³´ë©´, ì•„ê¹Œ urlë¡œ ë°›ì€ idê°’ì„ ë„˜ê²¨ ì‹¤ì œ userì •ë³´ì¤‘ ì¼ì¹˜í•˜ëŠ” idê°’ì„ ê°€ì§„ user ì •ë³´ë¥¼ ë±‰ì–´ë‚´ê²Œ êµ¬í˜„ë˜ì–´ ìˆë‹¤.</p>

<p>ì´ë ‡ê²Œ í•´ë‹¹ë˜ëŠ” ì‹¤ì œ ë¡œì§ ì‹¤í–‰ í›„ í•´ë‹¹ë˜ëŠ” ê°’ì„ returní•´ì£¼ë©´ controllerì—ì„œëŠ” serviceì—ì„œ return ëœ ê°’ì„ ë°›ì•„ì„œ ì–´ë–»ê²Œ ì²˜ë¦¬í• ì§€ ê²°ì •í•œë‹¤.</p>

<p>ìœ„ì— êµ¬í˜„ëœ controllerë°©ë²•ë³´ë‹¤ ì¡°ê¸ˆ ë” ê°„ë‹¨í•˜ê³  íš¨ê³¼ì ìœ¼ë¡œ êµ¬í˜„í•´ë³´ì.</p>

<div class="language-typescript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">@</span><span class="nd">Get</span><span class="p">(</span><span class="dl">'</span><span class="s1">/search/:id</span><span class="dl">'</span><span class="p">)</span>
  <span class="nx">searchCustomerById</span><span class="p">(@</span><span class="nd">Param</span><span class="p">(</span><span class="dl">'</span><span class="s1">id</span><span class="dl">'</span><span class="p">,</span> <span class="nx">ParseIntPipe</span><span class="p">)</span> <span class="nx">id</span><span class="p">:</span> <span class="kr">number</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">const</span> <span class="nx">customer</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">customersService</span><span class="p">.</span><span class="nx">findCustomerById</span><span class="p">(</span><span class="nx">id</span><span class="p">);</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">customer</span><span class="p">)</span> <span class="k">return</span> <span class="nx">customer</span><span class="p">;</span>
    <span class="k">else</span> <span class="k">throw</span> <span class="k">new</span> <span class="nx">HttpException</span><span class="p">(</span><span class="dl">'</span><span class="s1">Customer Not Found!</span><span class="dl">'</span><span class="p">,</span> <span class="nx">HttpStatus</span><span class="p">.</span><span class="nx">BAD_REQUEST</span><span class="p">);</span>
  <span class="p">}</span>
</code></pre></div></div>
<p>êµ¬í˜„ëœ í•¨ìˆ˜ë¥¼ ë³´ë©´ ìœ„ì˜ êµ¬í˜„ë°©ì‹ê³¼ í°ì°¨ì´ëŠ” ì—†ë‹¤. ë‹¤ë§Œ serviceì—ì„œ ë„˜ì–´ì˜¨ ê°’ì„ ê°€ì§€ê³  ì²˜ë¦¬í•˜ëŠ” ë°©ì‹ì— ìˆì–´ì„œ ì°¨ì´ê°€ ë‚œë‹¤.</p>

<p>return ë˜ëŠ” customerê°’ì´ ì—†ë‹¤ë©´ HttpExceptionì„ ë°œìƒì‹œì¼œ messageë¥¼ ë„˜ê²¨ì£¼ê²Œ ëœë‹¤.</p>

<p>ì´ë•Œ, ìœ„ì— êµ¬í˜„ëœ ë°©ë²•ê³¼ ë‹¤ë¥¸ ì°¨ì´ì ì„ ì‚´í´ë³´ì.</p>

<p><img src="/img/nest_2/1.png" /></p>

<p>êµ¬í˜„ëœ ìˆœì„œëŒ€ë¡œì˜ ê²°ê³¼ë‹¤. ë°‘ì— ê°„ë‹¨í•˜ê²Œ êµ¬í˜„í•œ ì˜ˆì‹œë¥¼ ë³´ë©´ statusCodeë„ ì¹œì ˆí•˜ê²Œ ë‚˜ì™€ìˆìœ¼ë©°, ì‹¤ì œ apië¥¼ êµ¬ì„±í• ë•Œ ì£¼ë¡œ ì‚¬ìš©ë˜ëŠ” ë°©ë²•ì´ë¼ê³  í•œë‹¤.</p>

<h2 id="post-requests--data-transfer-objects">Post Requests &amp; Data Transfer Objects</h2>

<p>POST requestì˜ ì²˜ë¦¬ ë°©ë²•ì„ ì•Œì•„ë³´ì.
ì‚¬ìš©ë°©ë²•ì€ ê·¸ë ‡ê²Œ ì–´ë µì§€ ì•Šë‹¤ ê·¸ë™ì•ˆ @Get() annotationì„ ë¶™ì—¬ì£¼ë˜ ê²ƒì„ @Post()ë¥¼ ë¶™ì—¬ì£¼ë©´ ëœë‹¤.</p>

<div class="language-typescript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">@</span><span class="nd">Post</span><span class="p">(</span><span class="dl">'</span><span class="s1">create</span><span class="dl">'</span><span class="p">)</span>
  <span class="nx">createCustomer</span><span class="p">(@</span><span class="nd">Body</span><span class="p">()</span> <span class="nx">createCustomerDto</span><span class="p">:</span> <span class="nx">CreateCustomerDto</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// console.log(createCustomerDto);</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">customersService</span><span class="p">.</span><span class="nx">createCustomer</span><span class="p">(</span><span class="nx">createCustomerDto</span><span class="p">);</span>
  <span class="p">}</span>
</code></pre></div></div>
<p>ìœ„ì˜ ì½”ë“œì²˜ëŸ¼ @Post íƒœê·¸ë¥¼ ì„¤ì •í•´ì£¼ê³  ì–´ë–¤ urlë¡œ ë‚´ê°€ ë°›ì„ ê²ƒì¸ì§€ ì„¤ì •í•´ì¤€ë‹¤.</p>

<p>ê·¸ëŸ¬ê³ ë‚˜ë©´ createCustomer(@Body() createCustomerDto: CreateCustomerDto) ê°€ ë³´ì´ëŠ”ë°, ì—¬ê¸°ì„œ CreateCustomerDtoëŠ” requestì— ë„˜ì–´ì˜¤ëŠ” body dataë¥¼ ê¸°ë³¸ ë°ì´í„° í˜•ì‹ì— ë§ê²Œ transferí•´ì£¼ëŠ” ì—­í• ì„ í•˜ê²Œ ëœë‹¤. í˜„ì¬ëŠ” DBë¥¼ ë”°ë¡œ ì‚¬ìš©í•˜ê³  ìˆì§€ ì•Šì•„ì„œ classì˜ í˜•íƒœë¥¼ ë ê³  ìˆì§€ë§Œ í›„ì—ëŠ” ë” ê¹Šì´ìˆê²Œ ì“°ì¼ ì˜ˆì •ì´ë¼ê³  í•œë‹¤.</p>

<div class="language-typescript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">export</span> <span class="kd">class</span> <span class="nx">CreateCustomerDto</span> <span class="p">{</span>
    <span class="nl">email</span><span class="p">:</span> <span class="kr">string</span><span class="p">;</span>
    <span class="nl">id</span><span class="p">:</span><span class="kr">number</span><span class="p">;</span>
    <span class="nl">name</span><span class="p">:</span><span class="kr">string</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div></div>
<p>ìœ„ì˜ ì½”ë“œëŠ” Dtoë¥¼ ì˜ˆì‹œë¡œ ì§  ì½”ë“œì¸ë°, ë³´ë©´ í•­ëª©ë“¤ì´ ì •í•´ì ¸ìˆë‹¤. ì´ë•Œ postmanì´ë‚˜ ë‹¤ë¥¸ apië¥¼ ì´ì¤„ìˆ˜ ìˆëŠ” toolì„ ì´ìš©í•˜ì—¬ bodyì— Dtoì— ìˆëŠ” key ê°’ì„ ë‹´ì•„ì„œ ë³´ë‚´ë©´ ìë™ìœ¼ë¡œ ì €ë ‡ê²Œ í•œë²ˆì— ë°›ì„ ìˆ˜ ìˆë‹¤.</p>

<p>ê¸°ì¡´ express appì„ ë§Œë“¤ë•ŒëŠ”,</p>
<div class="language-typescript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">req</span><span class="p">.</span><span class="nx">body</span><span class="p">.</span><span class="nx">email</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">email</span><span class="p">;</span>
<span class="nx">req</span><span class="p">.</span><span class="nx">body</span><span class="p">.</span><span class="nx">id</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">id</span><span class="p">;</span>
</code></pre></div></div>

<p>ìœ„ì™€ ê°™ì€ ë°©ë²•ìœ¼ë¡œ êµ¬ì„±í–ˆì—ˆëŠ”ë°, ì´ëŠ” êµ‰ì¥íˆ ìƒì‚°ì„± ì €í•˜ë¥¼ ì¼ìœ¼í‚¤ëŠ” ìš”ì†Œì¤‘ì— í•˜ë‚˜ì´ë‹¤. ì´ë¥¼ í†µí•´ ì½”ë“œ ì‘ì„± ì†ë„ë„ ì¢€ ë” ë¹¨ë¼ì§ˆ ê²ƒì´ê³  ì•„ë¬´ë˜ë„ ìˆ˜ê³ ê°€ ì¢€ ëœí•´ì§ˆ ìˆ˜ ìˆë‹¤.</p>

<h2 id="validating-post-requests">Validating POST Requests</h2>
<p>ë“¤ì–´ì˜¤ëŠ” dataì— ëŒ€í•´ validationì„ ì§„í–‰ì‹œí‚¬ìˆ˜ë„ ìˆë‹¤. ì´ë•ŒëŠ” libraryë¥¼ ì‚¬ìš©í•´ì„œ validateë¥¼ ì§„í–‰í•˜ë„ë¡ í•œë‹¤.</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>npm i --save class-validator class-transformer
</code></pre></div></div>

<p>ìœ„ì—ì„œ ì‘ì„±í•œ Dto ì½”ë“œì— bodyë¡œ ë“¤ì–´ì˜¨ parameterë“¤ì´ ì‹¤ì œë¡œ ë“¤ì–´ì˜¨ ê°’ì´ ì œëŒ€ë¡œ ë“¤ì–´ì˜¨ê±´ì§€ checkí•´ì£¼ëŠ” ì—­í• ì„ í•´ì¤€ë‹¤. ì›ë˜ëŒ€ë¡œë¼ë©´ validation í•¨ìˆ˜ë“¤ì„ ë‹¤ ë§Œë“¤ì–´ì„œ validateí•´ì¤˜ì•¼í•˜ì§€ë§Œ libraryë¥¼ ì´ìš©í•˜ë©´ annotationì„ ë¶™ì—¬ì£¼ëŠ” ê²ƒë§Œìœ¼ë¡œë„ ê°€ëŠ¥í•˜ë‹¤. ì•„ì£¼ í¸ë¦¬ ^_____^</p>

<p>controllerì—ì„œë„ validationì„ ì‚¬ìš©í•œë‹¤ëŠ” ê²ƒì„ ì•Œë ¤ì£¼ê¸° ìœ„í•´ @UsePipes(ValidationPipe) ë¼ëŠ” annotationì„ ê¸°ì¬í•´ ì•Œë ¤ì¤€ë‹¤.</p>
<div class="language-typescript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">@</span><span class="nd">Post</span><span class="p">(</span><span class="dl">'</span><span class="s1">create</span><span class="dl">'</span><span class="p">)</span>
  <span class="p">@</span><span class="nd">UsePipes</span><span class="p">(</span><span class="nx">ValidationPipe</span><span class="p">)</span>
  <span class="nx">createCustomer</span><span class="p">(@</span><span class="nd">Body</span><span class="p">()</span> <span class="nx">createCustomerDto</span><span class="p">:</span> <span class="nx">CreateCustomerDto</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// console.log(createCustomerDto);</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">customersService</span><span class="p">.</span><span class="nx">createCustomer</span><span class="p">(</span><span class="nx">createCustomerDto</span><span class="p">);</span>
  <span class="p">}</span>
</code></pre></div></div>

<p>validationì€ í•˜ë‚˜ë§Œ í•´ì•¼í•˜ëŠ” ê²ƒì€ ì•„ë‹ˆë‹¤. ë‘ê°œ ì´ìƒë„ ì‚¬ìš©ì´ ê°€ëŠ¥í•˜ë‹¤. ì˜ˆë¥¼ ë“¤ë©´ ë‚´ê°€ idë¼ëŠ” ê°’ì„ ìˆ«ìì¸ì§€, í˜¹ì€ ë¹„ì–´ìˆëŠ” ê°’ì¸ì§€ì— ëŒ€í•´ validateì„ í•œë‹¤ê³  í•˜ë©´ ë‘ê°€ì§€ ëª¨ë‘ validation annotationì„ ë‹¬ì•„ì£¼ë©´ ëœë‹¤.</p>
<div class="language-typescript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">@</span><span class="nd">IsNumberString</span><span class="p">()</span>
    <span class="p">@</span><span class="nd">IsNotEmpty</span><span class="p">()</span>
    <span class="nx">id</span><span class="p">:</span><span class="kr">number</span><span class="p">;</span>
</code></pre></div></div>

<p>Dto íŒŒì¼ ì•ˆì—ì„œ ë‹¤ë¥¸ dtoíŒŒì¼ì„ ë°›ì„ ìˆ˜ë„ ìˆë‹¤. DtoëŠ” classí˜•íƒœë¥¼ ë„ê¸° ë•Œë¬¸ì— ì—¬ëŸ¬ typeë“¤ì´ ëª¨ì—¬ìˆëŠ” í•˜ë‚˜ì˜ typeìœ¼ë¡œ ìƒê°í•´ì¤„ ìˆ˜ ìˆë‹¤. ë”°ë¼ì„œ í•˜ë‚˜ì˜ Dtoì—ì„œ typeì´ ìƒˆë¡œìš´ classì¸ í˜•íƒœì˜ ê°ì²´ë¥¼ ë°›ì„ ìˆ˜ë„ ìˆëŠ”ë° ì´ëŸ´ ë•ŒëŠ” ìƒˆë¡œìš´ dtoë¥¼ ìƒì„± ë° validationì„ ê¸°ì¡´ì²˜ëŸ¼ í•´ì£¼ê³  ê·¸ ê°ì²´ë¥¼ ë°›ì€ dtoì—ì„œ ë³„ë„ì˜ ì‘ì—…ì„ í•´ì¤˜ì•¼í•œë‹¤.</p>

<p>ì˜ˆë¥¼ ë“¤ë©´,</p>
<div class="language-typescript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">export</span> <span class="kd">class</span> <span class="nx">CreateCustomerDto</span> <span class="p">{</span>
  <span class="p">@</span><span class="nd">IsEmail</span><span class="p">()</span>
  <span class="nx">email</span><span class="p">:</span> <span class="kr">string</span><span class="p">;</span>

  <span class="p">@</span><span class="nd">IsNumberString</span><span class="p">()</span>
  <span class="p">@</span><span class="nd">IsNotEmpty</span><span class="p">()</span>
  <span class="nx">id</span><span class="p">:</span> <span class="kr">number</span><span class="p">;</span>

  <span class="p">@</span><span class="nd">IsNotEmpty</span><span class="p">()</span>
  <span class="nx">name</span><span class="p">:</span> <span class="kr">string</span><span class="p">;</span>

  <span class="p">@</span><span class="nd">IsNotEmptyObject</span><span class="p">()</span>
  <span class="p">@</span><span class="nd">ValidateNested</span><span class="p">()</span>
  <span class="p">@</span><span class="nd">Type</span><span class="p">(()</span> <span class="o">=&gt;</span> <span class="nx">CreateAddressDto</span><span class="p">)</span>
  <span class="nx">address</span><span class="p">:</span> <span class="nx">CreateAddressDto</span><span class="p">;</span>
<span class="p">}</span>

</code></pre></div></div>
<p>ìœ„ì˜ ì½”ë“œë¥¼ ë³´ë©´ addressë¼ëŠ” CreateAddressDto typeì˜ ë°ì´í„°ë¥¼ ë°›ê³  ìˆë‹¤. ìœ„ì˜ @IsNotEmptyObject()ëŠ” ì‹¤ì œ ë“¤ì–´ì˜¨ bodyì— ì € í˜•íƒœì˜ ë°ì´í„°ê°€ ë“¤ì–´ìˆëŠ”ì§€ ë¬»ëŠ” ê²ƒì´ê³ , @ValidateNested() ë° @Type(() =&gt; CreateAddressDto) ëŠ” ë“¤ì–´ì˜¨ dataì˜ transferë¥¼ í†µí•´ ì‹¤ì œ ë“¤ì–´ì˜¨ ë°ì´í„°ë¥¼ CreateAddressDtoì˜ validationì— ë§ì¶°ì„œ validationì„ ì§„í–‰í•˜ê²Œ ëœë‹¤.</p>

<h2 id="filtering-passwords">Filtering Passwords</h2>
<p>userì˜ passwordë¥¼ filteringí•˜ëŠ” ê¸°ëŠ¥ì„ êµ¬í˜„í•´ë³´ì.</p>

<p>ì¼ë‹¨ userì— ê´€ë ¨ëœ ê¸°ëŠ¥ì„ ì‘ì„±í•  ê²ƒì´ê¸° ë•Œë¬¸ì— userì— ê´€ë ¨í•œ controller, service, module ë“±ì„ ì‘ì„±í•´ì¤€ë‹¤.</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>nest g module users

nest g controller users/controllers/users

nest g service users/services/users
</code></pre></div></div>

<p>Userì— ëŒ€í•œ dataí˜•ì‹ì„ ë§Œë“¤ì–´ì¤€ë‹¤. types-&gt;User.ts ìƒì„±</p>

<div class="language-typescript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">export</span> <span class="kr">interface</span> <span class="nx">User</span> <span class="p">{</span>
    <span class="nl">username</span><span class="p">:</span> <span class="kr">string</span><span class="p">;</span>
    <span class="nl">password</span><span class="p">:</span> <span class="kr">string</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div></div>

<h3 id="service-êµ¬í˜„">service êµ¬í˜„</h3>
<div class="language-typescript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">import</span> <span class="p">{</span> <span class="nx">Injectable</span> <span class="p">}</span> <span class="k">from</span> <span class="dl">'</span><span class="s1">@nestjs/common</span><span class="dl">'</span><span class="p">;</span>
<span class="k">import</span> <span class="p">{</span> <span class="nx">User</span> <span class="p">}</span> <span class="k">from</span> <span class="dl">'</span><span class="s1">src/users/types/User</span><span class="dl">'</span><span class="p">;</span>

<span class="p">@</span><span class="nd">Injectable</span><span class="p">()</span>
<span class="k">export</span> <span class="kd">class</span> <span class="nx">UsersService</span> <span class="p">{</span>
  <span class="k">private</span> <span class="nx">users</span><span class="p">:</span> <span class="nx">User</span><span class="p">[]</span> <span class="o">=</span> <span class="p">[</span>
    <span class="p">{</span>
      <span class="na">username</span><span class="p">:</span> <span class="dl">'</span><span class="s1">test1</span><span class="dl">'</span><span class="p">,</span>
      <span class="na">password</span><span class="p">:</span> <span class="dl">'</span><span class="s1">test1</span><span class="dl">'</span><span class="p">,</span>
    <span class="p">},</span>
    <span class="p">{</span>
      <span class="na">username</span><span class="p">:</span> <span class="dl">'</span><span class="s1">test2</span><span class="dl">'</span><span class="p">,</span>
      <span class="na">password</span><span class="p">:</span> <span class="dl">'</span><span class="s1">test2</span><span class="dl">'</span><span class="p">,</span>
    <span class="p">},</span>
    <span class="p">{</span>
      <span class="na">username</span><span class="p">:</span> <span class="dl">'</span><span class="s1">test3</span><span class="dl">'</span><span class="p">,</span>
      <span class="na">password</span><span class="p">:</span> <span class="dl">'</span><span class="s1">test3</span><span class="dl">'</span><span class="p">,</span>
    <span class="p">},</span>
    <span class="p">{</span>
      <span class="na">username</span><span class="p">:</span> <span class="dl">'</span><span class="s1">test4</span><span class="dl">'</span><span class="p">,</span>
      <span class="na">password</span><span class="p">:</span> <span class="dl">'</span><span class="s1">test4</span><span class="dl">'</span><span class="p">,</span>
    <span class="p">},</span>
  <span class="p">];</span>

  <span class="nx">getUsers</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">users</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="nx">getUserByUserName</span><span class="p">(</span><span class="nx">name</span><span class="p">:</span> <span class="kr">string</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">users</span><span class="p">.</span><span class="nx">find</span><span class="p">((</span><span class="nx">u</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="nx">u</span><span class="p">.</span><span class="nx">username</span> <span class="o">===</span> <span class="nx">name</span><span class="p">);</span>
  <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<p>ì•„ì§ ë°ì´í„°ë¥¼ DBì—ì„œ ë¶ˆëŸ¬ì˜¤ëŠ” ê²ƒì´ ì•„ë‹ˆê¸° ë•Œë¬¸ì— ì¼ë‹¨ ì„ì‹œë¡œ users arrayë¥¼ ë§Œë“¤ì–´ ì‚¬ìš©í•œë‹¤.</p>

<p>userModuleì—ì„œëŠ” ê¸°ì¡´ì— providerë¡œ serviceíŒŒì¼ì„ ë„£ì–´ì£¼ëŠ” ê²ƒê³¼ ë‹¤ë¥´ê²Œ ë„£ì–´ì¤˜ë³¸ë‹¤.</p>

<div class="language-typescript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">import</span> <span class="p">{</span> <span class="nx">Module</span> <span class="p">}</span> <span class="k">from</span> <span class="dl">'</span><span class="s1">@nestjs/common</span><span class="dl">'</span><span class="p">;</span>
<span class="k">import</span> <span class="p">{</span> <span class="nx">UsersController</span> <span class="p">}</span> <span class="k">from</span> <span class="dl">'</span><span class="s1">./controllers/users/users.controller</span><span class="dl">'</span><span class="p">;</span>
<span class="k">import</span> <span class="p">{</span> <span class="nx">UsersService</span> <span class="p">}</span> <span class="k">from</span> <span class="dl">'</span><span class="s1">./services/users/users.service</span><span class="dl">'</span><span class="p">;</span>

<span class="p">@</span><span class="nd">Module</span><span class="p">({</span>
  <span class="na">controllers</span><span class="p">:</span> <span class="p">[</span><span class="nx">UsersController</span><span class="p">],</span>
  <span class="na">providers</span><span class="p">:</span> <span class="p">[{</span>
    <span class="na">provide</span><span class="p">:</span> <span class="dl">"</span><span class="s2">USER_SERVICE</span><span class="dl">"</span><span class="p">,</span>
    <span class="na">useClass</span><span class="p">:</span> <span class="nx">UsersService</span><span class="p">,</span>
  <span class="p">}]</span>
<span class="p">})</span>
<span class="k">export</span> <span class="kd">class</span> <span class="nx">UsersModule</span> <span class="p">{}</span>
</code></pre></div></div>

<p>ìœ„ì˜ codeì—ì„œ provide ëª…ìœ¼ë¡œ UsersServiceë¥¼ ë³´ë‚´ì£¼ê³  ìˆê¸° ë•Œë¬¸ì— controllerì—ì„œ @Inject annotationìœ¼ë¡œ â€œUSER_SERVICEâ€ë¡œ ê°€ì ¸ì˜¬ ìˆ˜ ìˆë‹¤.</p>

<div class="language-typescript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">@</span><span class="nd">Controller</span><span class="p">(</span><span class="dl">'</span><span class="s1">users</span><span class="dl">'</span><span class="p">)</span>
<span class="k">export</span> <span class="kd">class</span> <span class="nx">UsersController</span> <span class="p">{</span>
  <span class="kd">constructor</span><span class="p">(</span>
    <span class="p">@</span><span class="nd">Inject</span><span class="p">(</span><span class="dl">'</span><span class="s1">USER_SERVICE</span><span class="dl">'</span><span class="p">)</span> <span class="k">private</span> <span class="k">readonly</span> <span class="nx">userService</span><span class="p">:</span> <span class="nx">UsersService</span><span class="p">,</span>
  <span class="p">)</span> <span class="p">{}</span>

  <span class="p">@</span><span class="nd">Get</span><span class="p">(</span><span class="dl">''</span><span class="p">)</span>
  <span class="nx">getUsers</span><span class="p">()</span> <span class="p">{}</span>
<span class="p">}</span>
</code></pre></div></div>
<p>í•˜ì§€ë§Œ user ì •ë³´ì¤‘ passwordëŠ” ë³´ì´ë©´ ì•ˆë˜ê¸° ë•Œë¬¸ì— apië¥¼ ë³´ë‚´ì¤„ ë•Œ ì œì™¸í•´ì•¼ í•  í•„ìš”ê°€ ìˆë‹¤.</p>

<p>@Exclude() annotationì„ ì‚¬ìš©í•´ì„œ ë‚´ë³´ë‚¼ ë•Œ ì œì™¸í•´ì•¼ í•˜ëŠ” ë¶€ë¶„ì„ í‘œì‹œí•´ì¤„ ìˆ˜ ìˆê³ , class-transformer libraryì˜ plainToInstance() í•¨ìˆ˜ë¥¼ í†µí•´ì„œ type ë³€í™˜ì„ í•´ì¤„ ìˆ˜ ìˆë‹¤.</p>

<div class="language-typescript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">import</span> <span class="p">{</span> <span class="nx">Exclude</span> <span class="p">}</span> <span class="k">from</span> <span class="dl">"</span><span class="s2">class-transformer</span><span class="dl">"</span><span class="p">;</span>

<span class="k">export</span> <span class="kr">interface</span> <span class="nx">User</span> <span class="p">{</span>
    <span class="nl">username</span><span class="p">:</span> <span class="kr">string</span><span class="p">;</span>
    <span class="nl">password</span><span class="p">:</span> <span class="kr">string</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">export</span> <span class="kd">class</span> <span class="nx">SerializedUser</span> <span class="p">{</span>
    <span class="nl">username</span><span class="p">:</span> <span class="kr">string</span><span class="p">;</span>

    <span class="p">@</span><span class="nd">Exclude</span><span class="p">()</span>
    <span class="nx">password</span><span class="p">:</span> <span class="kr">string</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div></div>

<div class="language-typescript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">getUsers</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">users</span><span class="p">.</span><span class="nx">map</span><span class="p">((</span><span class="nx">user</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="nx">plainToInstance</span><span class="p">(</span><span class="nx">SerializedUser</span><span class="p">,</span> <span class="nx">user</span><span class="p">));</span>
  <span class="p">}</span>
</code></pre></div></div>

<p>ì´ë ‡ê²Œ ê¸°ì¡´ì˜ userë¥¼ plainToInstance()ë¥¼ í†µí•´ì„œ SerializedUser í˜•íƒœë¡œ ë°”ê¿”ì¤€ë‹¤ë©´ return í•´ì¤„ ë•Œ @Excludeê°€ ë¶™ì€ passwordëŠ” ë³´ì´ì§€ ì•Šê²Œ ë‚˜ê°€ê²Œ ëœë‹¤.</p>

<h3 id="usernameì„-ë°›ì•„ì„œ-íŠ¹ì •í•œ-userì˜-ì •ë³´ì—-ëŒ€í•´ì„œ-passwordë¥¼-excludeì‹œí‚¨-ë’¤-ë‚´ë³´ë‚´ê¸°">usernameì„ ë°›ì•„ì„œ íŠ¹ì •í•œ userì˜ ì •ë³´ì— ëŒ€í•´ì„œ passwordë¥¼ excludeì‹œí‚¨ ë’¤ ë‚´ë³´ë‚´ê¸°</h3>

<div class="language-typescript highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
<span class="nx">types</span><span class="o">/</span><span class="nx">index</span><span class="p">.</span><span class="nx">ts</span>

<span class="k">import</span> <span class="p">{</span> <span class="nx">Exclude</span> <span class="p">}</span> <span class="k">from</span> <span class="dl">"</span><span class="s2">class-transformer</span><span class="dl">"</span><span class="p">;</span>

<span class="k">export</span> <span class="kr">interface</span> <span class="nx">User</span> <span class="p">{</span>
    <span class="nl">username</span><span class="p">:</span> <span class="kr">string</span><span class="p">;</span>
    <span class="nl">password</span><span class="p">:</span> <span class="kr">string</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">export</span> <span class="kd">class</span> <span class="nx">SerializedUser</span> <span class="p">{</span>
    <span class="nl">username</span><span class="p">:</span> <span class="kr">string</span><span class="p">;</span>

    <span class="p">@</span><span class="nd">Exclude</span><span class="p">()</span>
    <span class="nx">password</span><span class="p">:</span> <span class="kr">string</span><span class="p">;</span>

    <span class="kd">constructor</span><span class="p">(</span><span class="nx">partial</span><span class="p">:</span> <span class="nb">Partial</span><span class="o">&lt;</span><span class="nx">SerializedUser</span><span class="o">&gt;</span><span class="p">)</span> <span class="p">{</span>
        <span class="nb">Object</span><span class="p">.</span><span class="nx">assign</span><span class="p">(</span><span class="k">this</span><span class="p">,</span> <span class="nx">partial</span><span class="p">);</span>
    <span class="p">}</span>
    
<span class="p">}</span>

</code></pre></div></div>

<div class="language-typescript highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
<span class="nx">UserController</span><span class="p">.</span><span class="nx">ts</span>

<span class="p">@</span><span class="nd">UseInterceptors</span><span class="p">(</span><span class="nx">ClassSerializerInterceptor</span><span class="p">)</span>
  <span class="p">@</span><span class="nd">Get</span><span class="p">(</span><span class="dl">'</span><span class="s1">/:username</span><span class="dl">'</span><span class="p">)</span>
  <span class="nx">getUserByUserName</span><span class="p">(@</span><span class="nd">Param</span><span class="p">(</span><span class="dl">'</span><span class="s1">username</span><span class="dl">'</span><span class="p">)</span> <span class="nx">username</span><span class="p">:</span> <span class="kr">string</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">const</span> <span class="nx">user</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">userService</span><span class="p">.</span><span class="nx">getUserByUserName</span><span class="p">(</span><span class="nx">username</span><span class="p">);</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">user</span><span class="p">)</span> <span class="k">return</span> <span class="k">new</span> <span class="nx">SerializedUser</span><span class="p">(</span><span class="nx">user</span><span class="p">);</span>
    <span class="k">else</span> <span class="k">throw</span> <span class="k">new</span> <span class="nx">HttpException</span><span class="p">(</span><span class="dl">'</span><span class="s1">User not found</span><span class="dl">'</span><span class="p">,</span> <span class="nx">HttpStatus</span><span class="p">.</span><span class="nx">BAD_REQUEST</span><span class="p">);</span>
  <span class="p">}</span>

</code></pre></div></div>

<p>SerializedUserë¥¼ ë³´ë©´ constructorë¥¼ ì¶”ê°€í•´ì„œ partialì„ ë„£ì–´ì¤¬ë‹¤. ì‚¬ì‹¤ ì´ê²Œ ë¬´ìŠ¨ ì˜ë¯¸ë¥¼ í•˜ëŠ”ì§€ëŠ” ì˜ ëª¨ë¥´ê³˜ìœ¼ë‚˜, controllerì—ì„œ UseInterceptors(ClassSerializerInterceptor)ë¥¼ í†µí•´ ì € ê¸°ëŠ¥ì„ ê¹¨ìš°ê³ 
return í•´ì£¼ëŠ” ë°ì´í„°ì— new SerializedUser(user)ë¡œ ì •ë³´ë¥¼ êµì²´í•´ì£¼ë©´ passwordë¥¼ ì œì™¸í•œ ë‚˜ë¨¸ì§€ ì •ë³´ê°€ ë‚˜ê°€ê²Œ ëœë‹¤.</p>

<p>ê°œë°œí•˜ëŠ” ì‚¬ëŒì˜ ì·¨í–¥ì¸ê±° ê°™ë‹¤. ê¸°ì¡´ì˜ ë°©ë²•ì²˜ëŸ¼ serviceì—ì„œ findí•œ userì— ëŒ€í•´ plainToInstanceë¥¼ í†µí•´ì„œ ë°”ê¿”ì£¼ëŠ” ì‚¬ëŒë„ ìˆì„ ìˆ˜ ìˆê³ , ì§€ê¸ˆì²˜ëŸ¼ controllerì—ì„œ ë°”ê¿”ì£¼ëŠ” ì‚¬ëŒë„ ìˆì„ ìˆ˜ ìˆë‹¤. ì •ë‹µì´ë¼ê¸° ë³´ë‹¤ëŠ” ìê¸°ì—ê²Œ ë§ëŠ” ë°©ì‹ìœ¼ë¡œ í•˜ë©´ ë  ê²ƒ ê°™ë‹¤.</p>
:ET