I"ét<h2 id="exceptions--handling-exceptions">Exceptions &amp; Handling Exceptions</h2>
<p>exceptionë“¤ì„ ë”°ë¡œ ëª¨ì•„ì¤„ ìˆ˜ ìˆëŠ” í´ë”ë¥¼ ë§Œë“¤ì–´ì„œ ê´€ë¦¬í•´ë³´ì.</p>

<p>users/exceptions/UserNotFound.exception.ts íŒŒì¼ì„ ë§Œë“¤ì–´ë³´ì.</p>

<div class="language-typescript highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
    <span class="k">import</span> <span class="p">{</span> <span class="nx">HttpException</span><span class="p">,</span> <span class="nx">HttpStatus</span> <span class="p">}</span> <span class="k">from</span> <span class="dl">'</span><span class="s1">@nestjs/common</span><span class="dl">'</span><span class="p">;</span>

    <span class="k">export</span> <span class="kd">class</span> <span class="nx">UserNotFoundException</span> <span class="kd">extends</span> <span class="nx">HttpException</span> <span class="p">{</span>
    <span class="kd">constructor</span><span class="p">(</span><span class="nx">msg</span><span class="p">:</span> <span class="kr">string</span><span class="p">,</span> <span class="nx">status</span><span class="p">:</span> <span class="nx">HttpStatus</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">super</span><span class="p">(</span><span class="nx">msg</span> <span class="o">||</span> <span class="dl">'</span><span class="s1">User Not Found</span><span class="dl">'</span><span class="p">,</span> <span class="nx">status</span> <span class="o">||</span> <span class="nx">HttpStatus</span><span class="p">.</span><span class="nx">NOT_FOUND</span><span class="p">);</span>
    <span class="p">}</span>
    <span class="p">}</span>

</code></pre></div></div>

<p>ì´ë ‡ê²Œ ìƒˆë¡œìš´ ë‚˜ë§Œì˜ exceptionì„ ë§Œë“¤ì–´ ì‚¬ìš©í•  ìˆ˜ ìˆë‹¤. ì‚¬ì‹¤ í•œë²ˆë„ ë‚´ê°€ exceptionì„ ë§Œë“¤ì–´ ì‚¬ìš©í•´ë³¸ ì ì€ ì—†ë‹¤. ë‚´ê°€ ì‚¬ìš©í•  exceptionë“¤ì€ ê¸°ì¡´ì— ì¡´ì¬í•˜ë˜ ë²”ì£¼ ë‚´ì—ì„œ ì‚¬ìš© ê°€ëŠ¥í•œ ê²ƒë“¤ì´ ëŒ€ë¶€ë¶„ì´ì—ˆë‹¤. í•˜ì§€ë§Œ ì‹¤ì œë¡œ ë‚˜ë§Œì˜ ì„œë¹„ìŠ¤ì—ì„œ ë­”ê°€ ë‚´ê°€ ë‚˜ë§Œì˜ ê¸°ëŠ¥ì—ì„œì˜ ê³µí†µëœ exceptionì„ ì£¼ê³ ì‹¶ì„ ë•ŒëŠ” ë”°ë¡œ ì´ë ‡ê²Œ íŒŒì¼ë¡œ ë§Œë“¤ì–´ ì‚¬ìš©í•˜ëŠ” ê²ƒë„ ê´œì°®ì€ ê²ƒ ê°™ë‹¤.</p>

<p>controller ì—ì„œëŠ”</p>

<div class="language-typescript highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
    <span class="p">@</span><span class="nd">UseInterceptors</span><span class="p">(</span><span class="nx">ClassSerializerInterceptor</span><span class="p">)</span>
    <span class="p">@</span><span class="nd">Get</span><span class="p">(</span><span class="dl">'</span><span class="s1">id/:id</span><span class="dl">'</span><span class="p">)</span>
    <span class="nx">getById</span><span class="p">(@</span><span class="nd">Param</span><span class="p">(</span><span class="dl">'</span><span class="s1">id</span><span class="dl">'</span><span class="p">,</span> <span class="nx">ParseIntPipe</span><span class="p">)</span> <span class="nx">id</span><span class="p">:</span> <span class="kr">number</span><span class="p">)</span> <span class="p">{</span>
        <span class="kd">const</span> <span class="nx">user</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">userService</span><span class="p">.</span><span class="nx">getUserById</span><span class="p">(</span><span class="nx">id</span><span class="p">);</span>

        <span class="k">if</span> <span class="p">(</span><span class="nx">user</span><span class="p">)</span> <span class="k">return</span> <span class="k">new</span> <span class="nx">SerializedUser</span><span class="p">(</span><span class="nx">user</span><span class="p">);</span>
        <span class="k">else</span> <span class="p">{</span>
            <span class="k">throw</span> <span class="k">new</span> <span class="nx">UserNotFoundException</span><span class="p">(</span><span class="dl">''</span><span class="p">,</span> <span class="nx">HttpStatus</span><span class="p">.</span><span class="nx">BAD_REQUEST</span><span class="p">);</span>
        <span class="p">}</span>
    <span class="p">}</span>

</code></pre></div></div>
<p>ì´ë ‡ê²Œ ê·¸ëƒ¥ ê¸°ì¡´ì— HttpExceptionì„ ì‚¬ìš©í•˜ëŠ” ê²ƒì²˜ëŸ¼ ì‚¬ìš©í•´ì£¼ë©´ ëœë‹¤. elseë¡œ throw new UserNotFoundExceptionì„ í•´ì£¼ì§€ ì•Šìœ¼ë©´ ì‹¤ì œë¡œ userë¥¼ ì°¾ì§€ ëª»í•œ ê²½ìš°ì— ì•„ë¬´ëŸ° returnë„ ëŒì•„ì˜¤ì§€ ì•Šê³  elseë¡œ ì²˜ë¦¬ë¥¼ í•´ì¤˜ì•¼ ì•„ë˜ ê·¸ë¦¼ì²˜ëŸ¼ ì •ìƒì ìœ¼ë¡œ exception msgê°€ ì „ë‹¬ëœë‹¤.</p>

<p><img src="/img/nest_4/1.png" />
<img src="/img/nest_4/2.png" /></p>

<p>nestjsì—ëŠ” built-in ëœ exceptionë“¤ì´ ë§ì´ ì¡´ì¬í•˜ë©° ì‹¤ì œë¡œ ìš°ë¦¬ê°€ ê°œë°œí•˜ë©° ë¶€ë”«íˆëŠ” exceptionë“¤ì€ ëŒ€ë¶€ë¶„ ì´ ë²”ì£¼ë‚´ì— ì¡´ì¬í•  ê²ƒì´ë‹¤. ì¡´ì¬í•˜ëŠ” exceptionì€ ì•„ë˜ ê·¸ë¦¼ê³¼ ê°™ë‹¤.</p>

<p><img src="/img/nest_4/3.png" /></p>

<h3 id="exception-filters">Exception Filters</h3>
<p>built-in ëœ exceptionì„ ë‚˜ì˜ ì…ë§›ì— ë§ê²Œ ì™„ì „ customì„ ê°€ëŠ¥í•˜ê²Œ í•´ì£¼ëŠ” ë°©ë²•ì´ë‹¤. ê¸°ì¡´ì— ë§Œë“¤ì–´ì§„ í‹€ì— ë§ì¶°ì„œ ì‚¬ìš©í•  ìˆ˜ë„ ìˆì§€ë§Œ ê¸°ë³¸ ê¸°ëŠ¥ì€ ì“°ë˜ ë‚´ê°€ ë§Œì•½ íŠ¹ì • exceptionì— ëŒ€í•´ì„œ ë‚˜ì˜ ì„œë¹„ìŠ¤ì—ì„œëŠ” ë¡œê·¸ë¥¼ ë‚¨ê¸´ë‹¤ë˜ê°€ ì¶”ê°€ ê¸°ëŠ¥ì„ ì‚¬ìš©í•˜ê³  ì‹¶ì„ ë•Œ ì‚¬ìš©í•˜ëŠ” ê¸°ëŠ¥ì´ë‹¤.</p>

<p>users/filters/HttpException.filter.ts íŒŒì¼ì„ ë§Œë“¤ì–´ë³´ì.</p>

<div class="language-typescript highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
    <span class="k">import</span> <span class="p">{</span> <span class="nx">HttpException</span><span class="p">,</span> <span class="nx">HttpStatus</span> <span class="p">}</span> <span class="k">from</span> <span class="dl">'</span><span class="s1">@nestjs/common</span><span class="dl">'</span><span class="p">;</span>

    <span class="k">export</span> <span class="kd">class</span> <span class="nx">UserNotFoundException</span> <span class="kd">extends</span> <span class="nx">HttpException</span> <span class="p">{</span>
    <span class="kd">constructor</span><span class="p">(</span><span class="nx">msg</span><span class="p">:</span> <span class="kr">string</span><span class="p">,</span> <span class="nx">status</span><span class="p">:</span> <span class="nx">HttpStatus</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">super</span><span class="p">(</span><span class="nx">msg</span> <span class="o">||</span> <span class="dl">'</span><span class="s1">User Not Found</span><span class="dl">'</span><span class="p">,</span> <span class="nx">status</span> <span class="o">||</span> <span class="nx">HttpStatus</span><span class="p">.</span><span class="nx">NOT_FOUND</span><span class="p">);</span>
    <span class="p">}</span>
    <span class="p">}</span>

</code></pre></div></div>

<p>controllerì—ì„œ filterë¥¼ ì‚¬ìš©í•´ì£¼ë ¤ë©´, @UseFilters(HttpExceptionFilter) annotationì„ ë¶™ì—¬ì„œ ì‚¬ìš©í•´ì£¼ì–´ì•¼ í•œë‹¤.</p>

<div class="language-typescript highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
    <span class="p">@</span><span class="nd">UseInterceptors</span><span class="p">(</span><span class="nx">ClassSerializerInterceptor</span><span class="p">)</span>
    <span class="p">@</span><span class="nd">UseFilters</span><span class="p">(</span><span class="nx">HttpExceptionFilter</span><span class="p">)</span>
    <span class="p">@</span><span class="nd">Get</span><span class="p">(</span><span class="dl">'</span><span class="s1">id/:id</span><span class="dl">'</span><span class="p">)</span>
    <span class="nx">getById</span><span class="p">(@</span><span class="nd">Param</span><span class="p">(</span><span class="dl">'</span><span class="s1">id</span><span class="dl">'</span><span class="p">,</span> <span class="nx">ParseIntPipe</span><span class="p">)</span> <span class="nx">id</span><span class="p">:</span> <span class="kr">number</span><span class="p">)</span> <span class="p">{</span>
        <span class="kd">const</span> <span class="nx">user</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">userService</span><span class="p">.</span><span class="nx">getUserById</span><span class="p">(</span><span class="nx">id</span><span class="p">);</span>

        <span class="k">if</span> <span class="p">(</span><span class="nx">user</span><span class="p">)</span> <span class="k">return</span> <span class="k">new</span> <span class="nx">SerializedUser</span><span class="p">(</span><span class="nx">user</span><span class="p">);</span>
        <span class="k">else</span> <span class="p">{</span>
            <span class="k">throw</span> <span class="k">new</span> <span class="nx">NotFoundException</span><span class="p">();</span>
        <span class="p">}</span>
    <span class="p">}</span>

</code></pre></div></div>

<p>ì´ë ‡ê²Œ ì‚¬ìš©í•´ì£¼ë©´ ì›ë˜ built-in ë˜ì–´ìˆë˜ NotFoundExceptionì„ ë°œìƒì‹œì¼°ì„ ë•Œ ìš°ë¦¬ê°€ ë³´ë˜ê±°ë‘ì€ ë‹¤ë¥¸ ê²°ê³¼ê°€ ë‚˜ì˜¨ë‹¤. ê¸°ì¡´ì— êµ¬í˜„ë˜ì–´ìˆë˜ ê¸°ëŠ¥ì„ ë®ì–´ì“°ê¸° í•˜ì—¬ ë‚˜ë§Œì˜ ê¸°ëŠ¥ìœ¼ë¡œ ì¬íƒ„ìƒ ì‹œí‚¨ ê²ƒì´ë‹¤.</p>

<p><img src="/img/nest_4/4.png" /></p>

<p>ìš°ë¦¬ëŠ” logë¥¼ ì°ëŠ” ê¸°ëŠ¥ì„ ì¶”ê°€í–ˆê³ , response.sendStatus(exception.getStatus()) ë¡œ statusë§Œ return í•´ì£¼ì—ˆê¸° ë•Œë¬¸ì— ê¸°ì¡´ì— ë‚ ë ¤ì£¼ë˜ ê¹”ë”í•œ json í˜•ì‹ê³¼ëŠ” ë‹¤ë¥¸ ê²°ê³¼ê°€ ì „ì†¡ëœë‹¤. ê·¸ë¦¬ê³  ì‹¤ì œë¡œ logê°€ ì°íˆëŠ” ê²ƒì„ ë³¼ ìˆ˜ ìˆë‹¤.</p>

<p><img src="/img/nest_4/5.png" /></p>

<p>@UseFiltersê°€ ë¶™ì€ ê³³ì—ëŠ” ì–´ë–¤ exceptionì´ ë“¤ì–´ì™€ë„ filterì— ìˆëŠ” ë‚´ìš©ì„ ìˆ˜í–‰í•´ì„œ ê²°ê³¼ê°€ return ëœë‹¤.</p>

<div class="language-typescript highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
    <span class="p">@</span><span class="nd">Catch</span><span class="p">(</span><span class="nx">HttpException</span><span class="p">)</span>
    <span class="k">export</span> <span class="kd">class</span> <span class="nx">HttpExceptionFilter</span> <span class="k">implements</span> <span class="nx">ExceptionFilter</span> <span class="p">{</span>
    <span class="k">catch</span><span class="p">(</span><span class="nx">exception</span><span class="p">:</span> <span class="nx">HttpException</span><span class="p">,</span> <span class="nx">host</span><span class="p">:</span> <span class="nx">ArgumentsHost</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">exception</span><span class="p">.</span><span class="nx">getResponse</span><span class="p">());</span>
        <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">exception</span><span class="p">.</span><span class="nx">getStatus</span><span class="p">());</span>
        <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">exception</span><span class="p">);</span>

        <span class="kd">const</span> <span class="nx">context</span> <span class="o">=</span> <span class="nx">host</span><span class="p">.</span><span class="nx">switchToHttp</span><span class="p">();</span>
        <span class="kd">const</span> <span class="nx">request</span> <span class="o">=</span> <span class="nx">context</span><span class="p">.</span><span class="nx">getRequest</span><span class="o">&lt;</span><span class="nx">Request</span><span class="o">&gt;</span><span class="p">();</span>
        <span class="kd">const</span> <span class="nx">response</span> <span class="o">=</span> <span class="nx">context</span><span class="p">.</span><span class="nx">getResponse</span><span class="o">&lt;</span><span class="nx">Response</span><span class="o">&gt;</span><span class="p">();</span>

        <span class="nx">response</span><span class="p">.</span><span class="nx">send</span><span class="p">({</span>
        <span class="na">status</span><span class="p">:</span> <span class="nx">exception</span><span class="p">.</span><span class="nx">getStatus</span><span class="p">(),</span>
        <span class="na">message</span><span class="p">:</span> <span class="nx">exception</span><span class="p">.</span><span class="nx">getResponse</span><span class="p">(),</span>
        <span class="p">});</span>
    <span class="p">}</span>
    <span class="p">}</span>

</code></pre></div></div>

<p>ìœ„ì™€ ê°™ì´ return ë˜ëŠ” í˜•ì‹ì„ ê¸°ì¡´ì˜ ë°©ì‹ê³¼ ë§ì¶°ì£¼ë©´ ê¸°ì¡´ì˜ í˜•ì‹ì²˜ëŸ¼ return ëœë‹¤. ì¦‰ ê¸°ì¡´ì— built-in ë˜ì–´ìˆëŠ” exception í•¨ìˆ˜ë“¤ì€ ê¸°ë³¸ì ìœ¼ë¡œ ì €ë ‡ê²Œ êµ¬í˜„ë˜ì–´ìˆê³ , ìš°ë¦¬ê°€ ì…ë§›ì— ë§ì¶° ë°”ê¿” ì‚¬ìš©í•˜ë ¤ë©´ filterë¥¼ í†µí•´ ì‚¬ìš©í•´ì•¼ ëœë‹¤.</p>

<h2 id="connecting-to-mysql-using-typeorm">Connecting to MySQL using TypeORM</h2>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>npm i --save @nestjs/typeorm typeorm mysql2
</code></pre></div></div>
<p>ë¥¼ í†µí•´ì„œ í•„ìš”í•œ packageë“¤ì„ ì„¤ì¹˜í•´ì¤€ë‹¤.</p>

<p>ì„¤ì¹˜í•´ì£¼ê³  ë‚˜ë©´ app.module.ts íŒŒì¼. ì¦‰, ë‚´ê°€ ì§€ê¸ˆ êµ¬ì„±í•˜ê³  ìˆëŠ” ìµœìƒìœ„ moduleíŒŒì¼ì— imports í•´ì£¼ê³  db ì—°ê²° ì •ë³´ë¥¼ ì ì–´ì¤€ë‹¤.</p>

<div class="language-typescript highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
    <span class="k">import</span> <span class="p">{</span> <span class="nx">Module</span> <span class="p">}</span> <span class="k">from</span> <span class="dl">'</span><span class="s1">@nestjs/common</span><span class="dl">'</span><span class="p">;</span>
    <span class="k">import</span> <span class="p">{</span> <span class="nx">TypeOrmModule</span> <span class="p">}</span> <span class="k">from</span> <span class="dl">'</span><span class="s1">@nestjs/typeorm</span><span class="dl">'</span><span class="p">;</span>
    <span class="k">import</span> <span class="p">{</span> <span class="nx">CustomersModule</span> <span class="p">}</span> <span class="k">from</span> <span class="dl">'</span><span class="s1">./customers/customers.module</span><span class="dl">'</span><span class="p">;</span>
    <span class="k">import</span> <span class="p">{</span> <span class="nx">UsersModule</span> <span class="p">}</span> <span class="k">from</span> <span class="dl">'</span><span class="s1">./users/users.module</span><span class="dl">'</span><span class="p">;</span>

    <span class="p">@</span><span class="nd">Module</span><span class="p">({</span>
    <span class="na">imports</span><span class="p">:</span> <span class="p">[</span>
        <span class="nx">CustomersModule</span><span class="p">,</span>
        <span class="nx">UsersModule</span><span class="p">,</span>
        <span class="nx">TypeOrmModule</span><span class="p">.</span><span class="nx">forRoot</span><span class="p">({</span>
        <span class="na">type</span><span class="p">:</span> <span class="dl">'</span><span class="s1">mysql</span><span class="dl">'</span><span class="p">,</span>
        <span class="na">host</span><span class="p">:</span> <span class="dl">'</span><span class="s1">localhost</span><span class="dl">'</span><span class="p">,</span>
        <span class="na">port</span><span class="p">:</span> <span class="mi">3306</span><span class="p">,</span>
        <span class="na">username</span><span class="p">:</span> <span class="dl">'</span><span class="s1">test</span><span class="dl">'</span><span class="p">,</span>
        <span class="na">password</span><span class="p">:</span> <span class="dl">'</span><span class="s1">1111</span><span class="dl">'</span><span class="p">,</span>
        <span class="na">database</span><span class="p">:</span> <span class="dl">'</span><span class="s1">tutorial_db</span><span class="dl">'</span><span class="p">,</span>
        <span class="na">entities</span><span class="p">:</span> <span class="p">[],</span>
        <span class="na">synchronize</span><span class="p">:</span> <span class="kc">true</span><span class="p">,</span>
        <span class="p">}),</span>
    <span class="p">],</span>
    <span class="na">controllers</span><span class="p">:</span> <span class="p">[],</span>
    <span class="na">providers</span><span class="p">:</span> <span class="p">[],</span>
    <span class="p">})</span>
    <span class="k">export</span> <span class="kd">class</span> <span class="nx">AppModule</span> <span class="p">{}</span>

</code></pre></div></div>
<p>ì´ë ‡ê²Œ í•œí›„ npm run start:dev ë¥¼ í•´ì£¼ê²Œ ë˜ë©´ ë‹¹ì—°íˆ ì˜¤ë¥˜ê°€ ë‚œë‹¤. ì™œëƒí•˜ë©´ ì•„ì§ tutorial_db ë¼ëŠ” ë°ì´í„°ë² ì´ìŠ¤ë¥¼ ë§Œë“¤ì§€ ì•Šì•˜ê¸° ë•Œë¬¸ì´ë‹¤. ì´ì œ ê·¸ ì‘ì—…ì„ í•´ë³´ì.</p>

<p>â€˜tutorial_dbâ€™ë¥¼ ë‚˜ì˜ local mysqlì— database ìƒì„±ì„ í•´ì£¼ê³  ì‹¤í–‰ì„í•˜ë©´ ì˜¤ë¥˜ê°€ ì‚¬ë¼ì§€ëŠ” ëª¨ìŠµì„ ë³¼ ìˆ˜ ìˆë‹¤.
typeorm í´ë”ë¥¼ ë§Œë“¤ê³  User.tsë¥¼ ë§Œë“¤ì–´ë³´ì. djangoì—ì„œì˜ model ì—­í• ì„ í•˜ëŠ” ì¹œêµ¬ì´ë‹¤.</p>

<div class="language-typescript highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
    <span class="k">import</span> <span class="p">{</span> <span class="nx">Column</span><span class="p">,</span> <span class="nx">Entity</span><span class="p">,</span> <span class="nx">PrimaryGeneratedColumn</span> <span class="p">}</span> <span class="k">from</span> <span class="dl">'</span><span class="s1">typeorm</span><span class="dl">'</span><span class="p">;</span>

    <span class="p">@</span><span class="nd">Entity</span><span class="p">()</span>
    <span class="k">export</span> <span class="kd">class</span> <span class="nx">User</span> <span class="p">{</span>
    <span class="p">@</span><span class="nd">PrimaryGeneratedColumn</span><span class="p">({</span>
        <span class="na">type</span><span class="p">:</span> <span class="dl">'</span><span class="s1">bigint</span><span class="dl">'</span><span class="p">,</span>
        <span class="na">name</span><span class="p">:</span> <span class="dl">'</span><span class="s1">user_id</span><span class="dl">'</span><span class="p">,</span>
    <span class="p">})</span>
    <span class="nx">id</span><span class="p">:</span> <span class="kr">number</span><span class="p">;</span>

    <span class="p">@</span><span class="nd">Column</span><span class="p">({</span>
        <span class="na">nullable</span><span class="p">:</span> <span class="kc">false</span><span class="p">,</span>
        <span class="na">default</span><span class="p">:</span> <span class="dl">''</span><span class="p">,</span>
    <span class="p">})</span>
    <span class="nx">username</span><span class="p">:</span> <span class="kr">string</span><span class="p">;</span>

    <span class="p">@</span><span class="nd">Column</span><span class="p">({</span>
        <span class="na">name</span><span class="p">:</span> <span class="dl">'</span><span class="s1">email_address</span><span class="dl">'</span><span class="p">,</span>
        <span class="na">nullable</span><span class="p">:</span> <span class="kc">false</span><span class="p">,</span>
        <span class="na">default</span><span class="p">:</span> <span class="dl">''</span><span class="p">,</span>
    <span class="p">})</span>
    <span class="nx">emailAddress</span><span class="p">:</span> <span class="kr">string</span><span class="p">;</span>

    <span class="p">@</span><span class="nd">Column</span><span class="p">({</span>
        <span class="na">nullable</span><span class="p">:</span> <span class="kc">false</span><span class="p">,</span>
        <span class="na">default</span><span class="p">:</span> <span class="dl">''</span><span class="p">,</span>
    <span class="p">})</span>
    <span class="nx">password</span><span class="p">:</span> <span class="kr">string</span><span class="p">;</span>

    <span class="p">}</span>

</code></pre></div></div>
<p>python djangoì—ì„œì˜ modelì˜ ì—­í• ì„ í•´ì¤€ë‹¤. ê·¼ë° ì•½ê°„ ë” ì§ê´€ì ì´ë¼ê³  ë³´ì¸ë‹¤ ë‚´ëˆˆì—”.</p>

<p>ê·¸ë¦¬ê³  typeormë“¤ì„ ê´€ë¦¬í•˜ëŠ” íŒŒì¼ì„ typeorm í´ë”ì— index.ts íŒŒì¼ë¡œ ìƒì„±í•´ì¤€ë‹¤. ë‚´ìš©ì€,</p>

<div class="language-typescript highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
    <span class="k">import</span> <span class="p">{</span> <span class="nx">User</span> <span class="p">}</span> <span class="k">from</span> <span class="dl">'</span><span class="s1">./User</span><span class="dl">'</span><span class="p">;</span>

    <span class="kd">const</span> <span class="nx">entities</span> <span class="o">=</span> <span class="p">[</span><span class="nx">User</span><span class="p">];</span>

    <span class="k">export</span> <span class="p">{</span> <span class="nx">User</span> <span class="p">};</span>

    <span class="k">export</span> <span class="k">default</span> <span class="nx">entities</span><span class="p">;</span>
    
</code></pre></div></div>

<p>ì´ë ‡ê²Œ ìƒê²¼ìœ¼ë©°, ì „ì²´ entitiesë¥¼ export í•´ì£¼ê³  ì „ì²´ app.module.tsì—ì„œ entities ë¶€ë¶„ì— ì±„ì›Œë„£ì–´ì¤€ë‹¤.</p>

<p><img src="/img/nest_4/6.png" /></p>

<p>ê·¸ë¦¬ê³  ì €ì¥ì„ í•´ì£¼ê²Œ ë˜ë©´ synchronizeê°€ true ìƒíƒœì´ê¸° ë•Œë¬¸ì— ë‚˜ì˜ mysqlì„ í™•ì¸í•´ë³´ë©´ tableì´ ìƒê²¼ìŒì„ ì•Œ ìˆ˜ ìˆë‹¤.</p>

<p>ê·¸ëŸ¼ ë§Œë“¤ì–´ì§„ databaseì— ëŒ€í•´ì„œ ìˆ˜ì •ì€ ì–´ë–»ê²Œ í• ê¹Œ?</p>

<p>synchronizeê°€ trueì´ê¸° ë•Œë¬¸ì— ë‚´ìš©ì„,
<img src="/img/nest_4/7.png" />
ì´ë ‡ê²Œ ë°”ê¿”ì£¼ê³  ì €ì¥ì„ í•˜ë©´ ì €ì ˆë¡œ mysqlì— ë°˜ì˜ë˜ì–´ìˆëŠ” ê²ƒì„ ì•Œ ìˆ˜ ìˆë‹¤.</p>

<h2 id="saving-users-to-database">Saving Users to Database</h2>
<p>ê·¸ëŸ¼ ì‹¤ì œë¡œ ë°ì´í„°ë² ì´ìŠ¤ì— user ì •ë³´ë¥¼ ì €ì¥í•´ë³´ì.</p>

<p>ë¨¼ì €, user.controller.tsì— createUserí•¨ìˆ˜ë¥¼ ë§Œë“¤ì–´ url ë°›ì„ ì¤€ë¹„ë¥¼ í•´ë³´ì.</p>

<p>ê·¸ë¦¬ê³  ì´ì „ì— customerì— ëŒ€í•´ì„œ dtoë¥¼ ë§Œë“¤ì—ˆë˜ê²ƒ ì²˜ëŸ¼ userì— ëŒ€í•´ì„œë„ dtoë¥¼ ë§Œë“¤ì–´ì£¼ê³  class-validatorë¡œ ë“¤ì–´ì˜¤ëŠ” ì •ë³´ë¥¼ validateí•´ì¤„ ê±´ë°, userì˜ ì •ë³´ì— ëŒ€í•œ ë‚´ìš©ì€ ì´ì „ì— typeorm/User.tsë¥¼ ë³´ë©´ ì•Œ ìˆ˜ ìˆë‹¤.</p>

<div class="language-typescript highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
    <span class="k">import</span> <span class="p">{</span> <span class="nx">IsEmail</span><span class="p">,</span> <span class="nx">IsNotEmpty</span><span class="p">,</span> <span class="nx">MinLength</span> <span class="p">}</span> <span class="k">from</span> <span class="dl">'</span><span class="s1">class-validator</span><span class="dl">'</span><span class="p">;</span>

    <span class="k">export</span> <span class="kd">class</span> <span class="nx">CreateUserDto</span> <span class="p">{</span>
    <span class="p">@</span><span class="nd">IsNotEmpty</span><span class="p">()</span>
    <span class="p">@</span><span class="nd">MinLength</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
    <span class="nx">username</span><span class="p">:</span> <span class="kr">string</span><span class="p">;</span>

    <span class="p">@</span><span class="nd">IsNotEmpty</span><span class="p">()</span>
    <span class="p">@</span><span class="nd">IsEmail</span><span class="p">()</span>
    <span class="nx">email</span><span class="p">:</span> <span class="kr">string</span><span class="p">;</span>

    <span class="p">@</span><span class="nd">IsNotEmpty</span><span class="p">()</span>
    <span class="p">@</span><span class="nd">MinLength</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>
    <span class="nx">password</span><span class="p">:</span> <span class="kr">string</span><span class="p">;</span>
    <span class="p">}</span>

</code></pre></div></div>

<p>ìœ„ì˜ ì½”ë“œë¥¼ í†µí•´ì„œ ìë™ìœ¼ë¡œ ë“¤ì–´ì˜¤ëŠ” ì •ë³´ë“¤ì„ ê²€í† í•˜ê³  ê²€í† í–ˆì„ ë•Œ ì í•©í•˜ì§€ ì•Šìœ¼ë©´ ì—ëŸ¬ë¥¼ return í•´ì¤€ë‹¤.</p>

<p><img src="/img/nest_4/8.png" /></p>

<p>ì´ë ‡ê²Œ í•´ë‹¹í•˜ëŠ” validatorì— ê±¸ë¦¬ë©´ ì˜¤ë¥˜ê°€ ë‚œë‹¤.</p>

<p>ê·¸ëŸ¬ë©´ ì´ì œ ì§„ì§œë¡œ urlë„ ì¤€ë¹„í•˜ê³  serviceë„ êµ¬í˜„í•´ì„œ ì‹¤ì œë¡œ databaseì— ë‚ ë¼ì˜¤ëŠ” ì •ë³´ë¥¼ ë„£ì–´ë³´ì. ì¼ë‹¨ controllerì— ìƒˆë¡œìš´ urlì„ ë°›ì„ ì¤€ë¹„ë¥¼ í•´ì£¼ì.</p>

<div class="language-typescript highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
  <span class="p">@</span><span class="nd">Post</span><span class="p">(</span><span class="dl">'</span><span class="s1">create</span><span class="dl">'</span><span class="p">)</span>
  <span class="p">@</span><span class="nd">UsePipes</span><span class="p">(</span><span class="nx">ValidationPipe</span><span class="p">)</span>
  <span class="nx">createUser</span><span class="p">(@</span><span class="nd">Body</span><span class="p">()</span> <span class="nx">createUserDto</span><span class="p">:</span> <span class="nx">CreateUserDto</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">userService</span><span class="p">.</span><span class="nx">createUser</span><span class="p">(</span><span class="nx">createUserDto</span><span class="p">);</span>
  <span class="p">}</span>

</code></pre></div></div>
<p>UsePipes(ValidationPipe) í•´ì£¼ëŠ” ê²ƒì„ ìŠì§€ë§ì. ê·¸ë¦¬ê³  @Body()ë¡œ ë°›ëŠ” ê²ƒë„ ì°¸ ì‹ ê¸°í•˜ê³  í¸í•œ ì¼ì´ë‹¤.</p>

<p>controllerì—ì„œ ì¤€ë¹„ê°€ ë˜ì—ˆë‹¤ë©´ ì´ì œ ì‹¤ì œ êµ¬í˜„í•˜ëŠ” serviceë¥¼ êµ¬í˜„í•´ë³´ì. serviceë¥¼ êµ¬ì„±í•˜ëŠ”ë°ì—ëŠ” ì¡°ê¸ˆ ìƒì†Œí•œ ë…¸ë ¥ì´ ë“¤ì–´ê°„ë‹¤. ì•„ë˜ì˜ ì½”ë“œë¥¼ ë³´ì.</p>

<div class="language-typescript highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
    <span class="p">@</span><span class="nd">Injectable</span><span class="p">()</span>
    <span class="k">export</span> <span class="kd">class</span> <span class="nx">UsersService</span> <span class="p">{</span>
    <span class="kd">constructor</span><span class="p">(</span>
        <span class="p">@</span><span class="nd">InjectRepository</span><span class="p">(</span><span class="nx">UserEntity</span><span class="p">)</span>
        <span class="k">private</span> <span class="k">readonly</span> <span class="nx">userRepository</span><span class="p">:</span> <span class="nx">Repository</span><span class="o">&lt;</span><span class="nx">UserEntity</span><span class="o">&gt;</span><span class="p">,</span>
    <span class="p">)</span> <span class="p">{}</span>

    <span class="k">private</span> <span class="nx">users</span><span class="p">:</span> <span class="nx">User</span><span class="p">[]</span> <span class="o">=</span> <span class="p">[];</span>

    <span class="nx">getUsers</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">users</span><span class="p">.</span><span class="nx">map</span><span class="p">((</span><span class="nx">user</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="nx">plainToInstance</span><span class="p">(</span><span class="nx">SerializedUser</span><span class="p">,</span> <span class="nx">user</span><span class="p">));</span>
    <span class="p">}</span>

    <span class="nx">getUserByUserName</span><span class="p">(</span><span class="nx">name</span><span class="p">:</span> <span class="kr">string</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">users</span><span class="p">.</span><span class="nx">find</span><span class="p">((</span><span class="nx">u</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="nx">u</span><span class="p">.</span><span class="nx">username</span> <span class="o">===</span> <span class="nx">name</span><span class="p">);</span>
        <span class="c1">// const user = this.users.find((u) =&gt; u.username === name);</span>
        <span class="c1">// if (user) return plainToInstance(SerializedUser, user);</span>
    <span class="p">}</span>

    <span class="nx">getUserById</span><span class="p">(</span><span class="nx">id</span><span class="p">:</span> <span class="kr">number</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">users</span><span class="p">.</span><span class="nx">find</span><span class="p">((</span><span class="nx">u</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="nx">u</span><span class="p">.</span><span class="nx">id</span> <span class="o">===</span> <span class="nx">id</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="nx">createUser</span><span class="p">(</span><span class="nx">createUserDto</span><span class="p">:</span> <span class="nx">CreateUserDto</span><span class="p">)</span> <span class="p">{</span>
        <span class="kd">const</span> <span class="nx">newUser</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">userRepository</span><span class="p">.</span><span class="nx">create</span><span class="p">(</span><span class="nx">createUserDto</span><span class="p">);</span>
        <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">userRepository</span><span class="p">.</span><span class="nx">save</span><span class="p">(</span><span class="nx">newUser</span><span class="p">);</span>
    <span class="p">}</span>
    <span class="p">}</span>

</code></pre></div></div>

<p>ìœ„ì˜ ì½”ë“œë¥¼ë³´ë©´ createUserê°€ í˜„ì¬ ìš°ë¦¬ê°€ êµ¬í˜„í•´ì•¼í•  í•¨ìˆ˜ì´ê³  contructorë¥¼ ë³´ë©´ Repositoryë¥¼ private readonlyë¡œ @Injectí•´ì˜¤ëŠ” ê²ƒì„ ë³¼ ìˆ˜ ìˆë‹¤.</p>

<p>@Inject í•´ì˜¨ userRepositoryì˜ ê¸°ëŠ¥ì„ í†µí•´ createí•˜ê³  saveë¥¼ í•´ì£¼ëŠ” ëª¨ìŠµì„ ë³¼ ìˆ˜ ìˆë‹¤.</p>

<p>ë³µì¡í•œ ê³¼ì •ì„ ì•Œì•„ì„œ ì²™ì²™í•´ì£¼ëŠ” typeormê°™ë‹¤.</p>

<p>ëª¨ë“  ì¤€ë¹„ë¥¼ ë§ˆì³¤ë‹¤ë©´, postmanì„ í†µí•´ í•´ë‹¹ urlë¡œ post ì „ì†¡í•˜ë©´ userê°€ databaseì— ì €ì¥ë˜ëŠ” ê²ƒì„ ì•Œ ìˆ˜ ìˆë‹¤.</p>

<p><img src="/img/nest_4/9.png" /></p>

<p><img src="/img/nest_4/10.png" /></p>
:ET